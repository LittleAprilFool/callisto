!function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=45)}([function(t,e){var n,i,r=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(t){if(n===setTimeout)return setTimeout(t,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(t){n=o}try{i="function"==typeof clearTimeout?clearTimeout:s}catch(t){i=s}}();var u,c=[],l=!1,h=-1;function f(){l&&u&&(l=!1,u.length?c=u.concat(c):h=-1,c.length&&p())}function p(){if(!l){var t=a(f);l=!0;for(var e=c.length;e;){for(u=c,c=[];++h<e;)u&&u[h].run();h=-1,e=c.length}u=null,l=!1,function(t){if(i===clearTimeout)return clearTimeout(t);if((i===s||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(t)}}function d(t,e){this.fun=t,this.array=e}function y(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];c.push(new d(t,e)),1!==c.length||l||a(p)},d.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=y,r.addListener=y,r.once=y,r.off=y,r.removeListener=y,r.removeAllListeners=y,r.emit=y,r.prependListener=y,r.prependOnceListener=y,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(t,e,n){function i(t,e){i.super.call(this,e),this.code=t}n(55)(i),t.exports=i},function(t,e){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e){e.doNothing=function(){},e.hasKeys=function(t){for(var e in t)return!0;return!1},e.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},e.isValidVersion=function(t){return null===t||e.isInteger(t)&&t>=0}},function(t,e,n){e.defaultType=n(25).type,e.map={},e.register=function(t){t.name&&(e.map[t.name]=t),t.uri&&(e.map[t.uri]=t)},e.register(e.defaultType)},function(t,e,n){var i=n(8).EventEmitter;e.EventEmitter=i,e.mixin=function(t){for(var e in i.prototype)t.prototype[e]=i.prototype[e]}},function(t,e){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},function(t,e,n){"use strict";var i=n(11),r=Object.keys||function(t){var e=[];for(var n in t)e.push(n);return e};t.exports=h;var o=n(9);o.inherits=n(6);var s=n(36),a=n(17);o.inherits(h,s);for(var u=r(a.prototype),c=0;c<u.length;c++){var l=u[c];h.prototype[l]||(h.prototype[l]=a.prototype[l])}function h(t){if(!(this instanceof h))return new h(t);s.call(this,t),a.call(this,t),t&&!1===t.readable&&(this.readable=!1),t&&!1===t.writable&&(this.writable=!1),this.allowHalfOpen=!0,t&&!1===t.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",f)}function f(){this.allowHalfOpen||this._writableState.ended||i.nextTick(p,this)}function p(t){t.end()}Object.defineProperty(h.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(h.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(t){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=t,this._writableState.destroyed=t)}}),h.prototype._destroy=function(t,e){this.push(null),this.end(),i.nextTick(e,t)}},function(t,e){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(t){return"function"==typeof t}function r(t){return"object"==typeof t&&null!==t}function o(t){return void 0===t}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(t){if(!function(t){return"number"==typeof t}(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},n.prototype.emit=function(t){var e,n,s,a,u,c;if(this._events||(this._events={}),"error"===t&&(!this._events.error||r(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var l=new Error('Uncaught, unspecified "error" event. ('+e+")");throw l.context=e,l}if(o(n=this._events[t]))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),n.apply(this,a)}else if(r(n))for(a=Array.prototype.slice.call(arguments,1),s=(c=n.slice()).length,u=0;u<s;u++)c[u].apply(this,a);return!0},n.prototype.addListener=function(t,e){var s;if(!i(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,i(e.listener)?e.listener:e),this._events[t]?r(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,r(this._events[t])&&!this._events[t].warned&&(s=o(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&s>0&&this._events[t].length>s&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(t,e){if(!i(e))throw TypeError("listener must be a function");var n=!1;function r(){this.removeListener(t,r),n||(n=!0,e.apply(this,arguments))}return r.listener=e,this.on(t,r),this},n.prototype.removeListener=function(t,e){var n,o,s,a;if(!i(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(s=(n=this._events[t]).length,o=-1,n===e||i(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(r(n)){for(a=s;a-- >0;)if(n[a]===e||n[a].listener&&n[a].listener===e){o=a;break}if(o<0)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(o,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},n.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(i(n=this._events[t]))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},n.prototype.listeners=function(t){return this._events&&this._events[t]?i(this._events[t])?[this._events[t]]:this._events[t].slice():[]},n.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(i(e))return 1;if(e)return e.length}return 0},n.listenerCount=function(t,e){return t.listenerCount(e)}},function(t,e,n){(function(t){function n(t){return Object.prototype.toString.call(t)}e.isArray=function(t){return Array.isArray?Array.isArray(t):"[object Array]"===n(t)},e.isBoolean=function(t){return"boolean"==typeof t},e.isNull=function(t){return null===t},e.isNullOrUndefined=function(t){return null==t},e.isNumber=function(t){return"number"==typeof t},e.isString=function(t){return"string"==typeof t},e.isSymbol=function(t){return"symbol"==typeof t},e.isUndefined=function(t){return void 0===t},e.isRegExp=function(t){return"[object RegExp]"===n(t)},e.isObject=function(t){return"object"==typeof t&&null!==t},e.isDate=function(t){return"[object Date]"===n(t)},e.isError=function(t){return"[object Error]"===n(t)||t instanceof Error},e.isFunction=function(t){return"function"==typeof t},e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=t.isBuffer}).call(this,n(39).Buffer)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(8);var r=n(46);e.isArrayEqual=function(t,e){if(t.length===e.length){for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}return!1},e.extend=function(t,...e){return e.forEach(e=>{if(e)for(let n in e)t[n]=e[n]}),t};class o extends i.EventEmitter{constructor(t,e){super(),this.url=t,this.protocols=e,this.forcedClose=!1,this.timedOut=!1,this.reconnectionAttempts=0,this.maxReconnectAttempts=!1,this.reconnectionDecay=1.3,this.reconnectInterval=1e3,this.timeoutInterval=2e3,this.onopen=(()=>{}),this.onclose=(()=>{}),this.onconnecting=(()=>{}),this.onmessage=(()=>{}),this.onerror=(()=>{}),this.readyState=o.CONNECTING,this.connect()}connect(t=!1){if(t){if(!1!==this.maxReconnectAttempts&&this.reconnectionAttempts>this.maxReconnectAttempts)return}else this.reconnectionAttempts=0;this.ws=new r(this.url,this.protocols),this.ws.addEventListener("open",t=>{this.reconnectionAttempts=0,this.readyState=o.OPEN,this.onopen(t),this.emit("open",t)}),this.ws.addEventListener("close",e=>{if(this.ws=null,this.forcedClose)this.readyState=o.CLOSED;else{this.readyState=o.CONNECTING,this.onconnecting(),this.emit("connecting"),t||this.timedOut||this.onclose(e);const n=this.reconnectInterval*Math.pow(this.reconnectionDecay,this.reconnectionAttempts);setTimeout(()=>{this.reconnectionAttempts++,this.connect(!0)},n)}}),this.ws.addEventListener("message",t=>{this.onmessage(t),this.emit("message",t)}),this.ws.addEventListener("error",t=>{this.onerror(t),this.emit("error",t)})}send(t){if(!this.ws)throw new Error("INVALID_STATE_ERR : Pausing to reconnect websocket");this.ws.send(t)}close(){return!!this.ws&&(this.forcedClose=!0,this.ws.close(),!0)}}o.CONNECTING=r.CONNECTING,o.OPEN=r.OPEN,o.CLOSING=r.CLOSING,o.CLOSED=r.CLOSED,e.ReconnectingWebsocket=o},function(t,e,n){"use strict";(function(e){!e.version||0===e.version.indexOf("v0.")||0===e.version.indexOf("v1.")&&0!==e.version.indexOf("v1.8.")?t.exports={nextTick:function(t,n,i,r){if("function"!=typeof t)throw new TypeError('"callback" argument must be a function');var o,s,a=arguments.length;switch(a){case 0:case 1:return e.nextTick(t);case 2:return e.nextTick(function(){t.call(null,n)});case 3:return e.nextTick(function(){t.call(null,n,i)});case 4:return e.nextTick(function(){t.call(null,n,i,r)});default:for(o=new Array(a-1),s=0;s<o.length;)o[s++]=arguments[s];return e.nextTick(function(){t.apply(null,o)})}}}:t.exports=e}).call(this,n(0))},function(t,e,n){var i=n(39),r=i.Buffer;function o(t,e){for(var n in t)e[n]=t[n]}function s(t,e,n){return r(t,e,n)}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?t.exports=i:(o(i,e),e.Buffer=s),o(r,s),s.from=function(t,e,n){if("number"==typeof t)throw new TypeError("Argument must not be a number");return r(t,e,n)},s.alloc=function(t,e,n){if("number"!=typeof t)throw new TypeError("Argument must be a number");var i=r(t);return void 0!==e?"string"==typeof n?i.fill(e,n):i.fill(e):i.fill(0),i},s.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return r(t)},s.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return i.SlowBuffer(t)}},function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(r,o){function s(t){try{u(i.next(t))}catch(t){o(t)}}function a(t){try{u(i.throw(t))}catch(t){o(t)}}function u(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(s,a)}u((i=i.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});const r=n(20),o=n(21),s=n(10);e.SDBDoc=class extends o.OpSubmittable{constructor(t,e,n){super(),this.docIdentifier=t,this.doc=e,this.sdb=n,this.subscribers=[],this.onOp=((t,e)=>{this.subscribers.forEach(n=>n("op",t,e,this.doc.data))}),this.onCreate=(()=>{this.subscribers.forEach(t=>t("create",null,null,this.doc.data))})}subDoc(t){return new r.SDBSubDoc(this,t)}getIdentifier(){return this.docIdentifier}getData(){return this.doc.data}traverse(t){let e=this.getData(),n=e;for(let i=0;i<t.length;i++)try{n=e=e[t[i]]}catch(e){throw new Error(`Could not traverse path ${t}. Object ${n} does not have property ${t[i]}`)}return e}static relative(t,e){const n=t.length;return s.isArrayEqual(t,e.slice(0,n))?e.slice(n):null}fetch(){return new Promise((t,e)=>{this.doc.fetch(n=>{n?e(n):t(this.doc)})})}create(t,e,n){return new Promise((i,r)=>{this.doc.create(t,e,n,()=>{i(this)})})}del(t=!0){return new Promise((e,n)=>{this.doc.del({source:t},t=>{t?n(t):(this.sdb.deleteDoc(this),e())})})}subscribe(t=(()=>null)){return this.subscribers.push(t),1===this.subscribers.length?(this.doc.addListener("op",this.onOp),this.doc.addListener("create",this.onCreate),new Promise((e,n)=>{this.doc.subscribe(i=>{if(t(null,null,null,this.doc.data),i)throw n(i),i;e()})})):(t(null,null,null,this.doc.data),Promise.resolve())}unsubscribe(t){let e;for(;(e=this.subscribers.indexOf(t))>=0;)this.subscribers.splice(e,1);0===this.subscribers.length&&(this.doc.removeListener("op",this.onOp),this.doc.removeListener("create",this.onCreate))}doSubmitOp(t,e=!0){return new Promise((n,i)=>{this.doc.submitOp(t,{source:e},t=>{t?i(t):n(this)})})}createIfEmpty(t,e,n){return i(this,void 0,void 0,function*(){return null===(yield this.fetch()).type?this.create(t,e,n):this})}destroy(){this.doc.destroy(),this.sdb.deleteDoc(this)}}},function(t,e){t.exports=function(t,e,n,i,r){this.id=t,this.v=e,this.type=n,this.data=i,this.m=r}},function(t,e,n){(function(e){var i=n(5),r=n(1),o=n(3);function s(t){i.EventEmitter.call(this),this.interval=t&&t.interval}t.exports=s,i.mixin(s),s.prototype.close=function(t){t&&e.nextTick(t)},s.prototype.getMilestoneSnapshot=function(t,n,i,o){var s=new r(5019,"getMilestoneSnapshot MilestoneDB method unimplemented");if(o)return e.nextTick(o,s);this.emit("error",s)},s.prototype.saveMilestoneSnapshot=function(t,n,i){var o=new r(5020,"saveMilestoneSnapshot MilestoneDB method unimplemented");if(i)return e.nextTick(i,o);this.emit("error",o)},s.prototype._isValidVersion=function(t){return o.isValidVersion(t)}}).call(this,n(0))},function(t,e,n){(e=t.exports=n(36)).Stream=e,e.Readable=e,e.Writable=n(17),e.Duplex=n(7),e.Transform=n(42),e.PassThrough=n(66)},function(t,e,n){"use strict";(function(e,i,r){var o=n(11);function s(t){var e=this;this.next=null,this.entry=null,this.finish=function(){!function(t,e,n){var i=t.entry;t.entry=null;for(;i;){var r=i.callback;e.pendingcb--,r(n),i=i.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}(e,t)}}t.exports=b;var a,u=!e.browser&&["v0.10","v0.9."].indexOf(e.version.slice(0,5))>-1?i:o.nextTick;b.WritableState=v;var c=n(9);c.inherits=n(6);var l={deprecate:n(65)},h=n(38),f=n(12).Buffer,p=r.Uint8Array||function(){};var d,y=n(40);function g(){}function v(t,e){a=a||n(7),t=t||{};var i=e instanceof a;this.objectMode=!!t.objectMode,i&&(this.objectMode=this.objectMode||!!t.writableObjectMode);var r=t.highWaterMark,c=t.writableHighWaterMark,l=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:i&&(c||0===c)?c:l,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var h=!1===t.decodeStrings;this.decodeStrings=!h,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(t){!function(t,e){var n=t._writableState,i=n.sync,r=n.writecb;if(function(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}(n),e)!function(t,e,n,i,r){--e.pendingcb,n?(o.nextTick(r,i),o.nextTick(O,t,e),t._writableState.errorEmitted=!0,t.emit("error",i)):(r(i),t._writableState.errorEmitted=!0,t.emit("error",i),O(t,e))}(t,n,i,e,r);else{var s=S(n);s||n.corked||n.bufferProcessing||!n.bufferedRequest||_(t,n),i?u(w,t,n,s,r):w(t,n,s,r)}}(e,t)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new s(this)}function b(t){if(a=a||n(7),!(d.call(b,this)||this instanceof a))return new b(t);this._writableState=new v(t,this),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),h.call(this)}function m(t,e,n,i,r,o,s){e.writelen=i,e.writecb=s,e.writing=!0,e.sync=!0,n?t._writev(r,e.onwrite):t._write(r,o,e.onwrite),e.sync=!1}function w(t,e,n,i){n||function(t,e){0===e.length&&e.needDrain&&(e.needDrain=!1,t.emit("drain"))}(t,e),e.pendingcb--,i(),O(t,e)}function _(t,e){e.bufferProcessing=!0;var n=e.bufferedRequest;if(t._writev&&n&&n.next){var i=e.bufferedRequestCount,r=new Array(i),o=e.corkedRequestsFree;o.entry=n;for(var a=0,u=!0;n;)r[a]=n,n.isBuf||(u=!1),n=n.next,a+=1;r.allBuffers=u,m(t,e,!0,e.length,r,"",o.finish),e.pendingcb++,e.lastBufferedRequest=null,o.next?(e.corkedRequestsFree=o.next,o.next=null):e.corkedRequestsFree=new s(e),e.bufferedRequestCount=0}else{for(;n;){var c=n.chunk,l=n.encoding,h=n.callback;if(m(t,e,!1,e.objectMode?1:c.length,c,l,h),n=n.next,e.bufferedRequestCount--,e.writing)break}null===n&&(e.lastBufferedRequest=null)}e.bufferedRequest=n,e.bufferProcessing=!1}function S(t){return t.ending&&0===t.length&&null===t.bufferedRequest&&!t.finished&&!t.writing}function k(t,e){t._final(function(n){e.pendingcb--,n&&t.emit("error",n),e.prefinished=!0,t.emit("prefinish"),O(t,e)})}function O(t,e){var n=S(e);return n&&(!function(t,e){e.prefinished||e.finalCalled||("function"==typeof t._final?(e.pendingcb++,e.finalCalled=!0,o.nextTick(k,t,e)):(e.prefinished=!0,t.emit("prefinish")))}(t,e),0===e.pendingcb&&(e.finished=!0,t.emit("finish"))),n}c.inherits(b,h),v.prototype.getBuffer=function(){for(var t=this.bufferedRequest,e=[];t;)e.push(t),t=t.next;return e},function(){try{Object.defineProperty(v.prototype,"buffer",{get:l.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(t){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(d=Function.prototype[Symbol.hasInstance],Object.defineProperty(b,Symbol.hasInstance,{value:function(t){return!!d.call(this,t)||this===b&&(t&&t._writableState instanceof v)}})):d=function(t){return t instanceof this},b.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},b.prototype.write=function(t,e,n){var i=this._writableState,r=!1,s=!i.objectMode&&function(t){return f.isBuffer(t)||t instanceof p}(t);return s&&!f.isBuffer(t)&&(t=function(t){return f.from(t)}(t)),"function"==typeof e&&(n=e,e=null),s?e="buffer":e||(e=i.defaultEncoding),"function"!=typeof n&&(n=g),i.ended?function(t,e){var n=new Error("write after end");t.emit("error",n),o.nextTick(e,n)}(this,n):(s||function(t,e,n,i){var r=!0,s=!1;return null===n?s=new TypeError("May not write null values to stream"):"string"==typeof n||void 0===n||e.objectMode||(s=new TypeError("Invalid non-string/buffer chunk")),s&&(t.emit("error",s),o.nextTick(i,s),r=!1),r}(this,i,t,n))&&(i.pendingcb++,r=function(t,e,n,i,r,o){if(!n){var s=function(t,e,n){t.objectMode||!1===t.decodeStrings||"string"!=typeof e||(e=f.from(e,n));return e}(e,i,r);i!==s&&(n=!0,r="buffer",i=s)}var a=e.objectMode?1:i.length;e.length+=a;var u=e.length<e.highWaterMark;u||(e.needDrain=!0);if(e.writing||e.corked){var c=e.lastBufferedRequest;e.lastBufferedRequest={chunk:i,encoding:r,isBuf:n,callback:o,next:null},c?c.next=e.lastBufferedRequest:e.bufferedRequest=e.lastBufferedRequest,e.bufferedRequestCount+=1}else m(t,e,!1,a,i,r,o);return u}(this,i,s,t,e,n)),r},b.prototype.cork=function(){this._writableState.corked++},b.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,t.writing||t.corked||t.finished||t.bufferProcessing||!t.bufferedRequest||_(this,t))},b.prototype.setDefaultEncoding=function(t){if("string"==typeof t&&(t=t.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((t+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+t);return this._writableState.defaultEncoding=t,this},Object.defineProperty(b.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),b.prototype._write=function(t,e,n){n(new Error("_write() is not implemented"))},b.prototype._writev=null,b.prototype.end=function(t,e,n){var i=this._writableState;"function"==typeof t?(n=t,t=null,e=null):"function"==typeof e&&(n=e,e=null),null!==t&&void 0!==t&&this.write(t,e),i.corked&&(i.corked=1,this.uncork()),i.ending||i.finished||function(t,e,n){e.ending=!0,O(t,e),n&&(e.finished?o.nextTick(n):t.once("finish",n));e.ended=!0,t.writable=!1}(this,i,n)},Object.defineProperty(b.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(t){this._writableState&&(this._writableState.destroyed=t)}}),b.prototype.destroy=y.destroy,b.prototype._undestroy=y.undestroy,b.prototype._destroy=function(t,e){this.end(),e(t)}}).call(this,n(0),n(23).setImmediate,n(2))},function(t,e,n){var i=n(4).map;e.checkOp=function(t){if(null==t||"object"!=typeof t)return{code:4004,message:"Missing op"};if(null!=t.create){if("object"!=typeof t.create)return{code:4006,message:"create data must be an object"};var e=t.create.type;if("string"!=typeof e)return{code:4007,message:"Missing create type"};var n=i[e];if(null==n||"object"!=typeof n)return{code:4008,message:"Unknown type"}}else if(null!=t.del){if(!0!==t.del)return{code:4009,message:"del value must be true"}}else if(null==t.op)return{code:4010,message:"Missing op, create, or del"};return null!=t.src&&"string"!=typeof t.src?{code:4011,message:"Invalid src"}:null!=t.seq&&"number"!=typeof t.seq?{code:4012,message:"Invalid seq"}:null==t.src&&null!=t.seq||null!=t.src&&null==t.seq?{code:4013,message:"Both src and seq must be set together"}:null!=t.m&&"object"!=typeof t.m?{code:4014,message:"op.m invalid"}:void 0},e.normalizeType=function(t){return i[t]&&i[t].uri},e.apply=function(t,e){if("object"!=typeof t)return{code:5002,message:"Missing snapshot"};if(null!=t.v&&null!=e.v&&t.v!==e.v)return{code:5003,message:"Version mismatch"};if(e.create){if(t.type)return{code:4016,message:"Document already exists"};var n=e.create,r=i[n.type];if(!r)return{code:4008,message:"Unknown type"};try{t.data=r.create(n.data),t.type=r.uri,t.v++}catch(o){return o}}else if(e.del)t.data=void 0,t.type=null,t.v++;else if(e.op){var o=function(t,e){if(!t.type)return{code:4015,message:"Document does not exist"};if(null==e)return{code:5004,message:"Missing op"};var n=i[t.type];if(!n)return{code:4008,message:"Unknown type"};try{t.data=n.apply(t.data,e)}catch(t){return t}}(t,e.op);if(o)return o;t.v++}else t.v++},e.transform=function(t,e,n){if(null!=e.v&&e.v!==n.v)return{code:5006,message:"Version mismatch"};if(n.del){if(e.create||e.op)return{code:4017,message:"Document was deleted"}}else{if(n.create&&(e.op||e.create||e.del)||n.op&&e.create)return{code:4018,message:"Document was created remotely"};if(n.op&&e.op){if(!t)return{code:5005,message:"Document does not exist"};if("string"==typeof t&&!(t=i[t]))return{code:4008,message:"Unknown type"};try{e.op=t.transform(e.op,n.op,"left")}catch(t){return t}}}null!=e.v&&e.v++}},function(t,e,n){var i=n(25).type;function r(t,e){if(e.type&&e.type!==i.uri)throw new Error(4023,"Cannot project snapshots of type "+e.type);e.data=s(t,e.data)}function o(t,e){if(e.type&&e.type!==i.uri)return!1;if(null==e.data)return!0;if("object"!=typeof e.data||Array.isArray(e.data))return!1;for(var n in e.data)if(!t[n])return!1;return!0}function s(t,e){if(null==e)return e;if("object"!=typeof e||Array.isArray(e))return null;var n={};for(var i in t)e.hasOwnProperty(i)&&(n[i]=e[i]);return n}e.projectSnapshot=r,e.projectSnapshots=function(t,e){for(var n=0;n<e.length;n++){var i=e[n];r(t,i)}},e.projectOp=function(t,e){e.create&&r(t,e.create);e.op&&(e.op=function(t,e){for(var n=[],i=0;i<e.length;i++){var r=e[i],o=r.p;if(0===o.length){var a={p:[]};void 0===r.od&&void 0===r.oi||(void 0!==r.od&&(a.od=s(t,r.od)),void 0!==r.oi&&(a.oi=s(t,r.oi)),n.push(a))}else t[o[0]]&&n.push(r)}return n}(t,e.op))},e.isSnapshotAllowed=o,e.isOpAllowed=function(t,e,n){if(n.create)return o(e,n.create);if(n.op)return(!t||t===i.uri)&&function(t,e){for(var n=0;n<e.length;n++){var i=e[n];if(0===i.p.length)return!1;if(!t[i.p[0]])return!1}return!0}(e,n.op);return!0}},function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(r,o){function s(t){try{u(i.next(t))}catch(t){o(t)}}function a(t){try{u(i.throw(t))}catch(t){o(t)}}function u(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(s,a)}u((i=i.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});const r=n(13),o=n(21),s=n(10);e.SDBSubDoc=class extends o.OpSubmittable{constructor(t,e){super(),this.doc=t,this.path=e,this.subscriptionShims=new Map}subscribe(t=(()=>null)){const e=(e,n,i,o)=>{if("op"===e){const o=[];if(n.forEach(t=>{const e=r.SDBDoc.relative(this.path,t.p);e&&o.push({op:t,rp:e})}),o.length>0){const n=o.map(({op:t,rp:e})=>s.extend({},t,{p:e}));t&&t(e,n,i,this.getData())}}else t&&t(e,n,i,this.getData())};return this.subscriptionShims.has(t)?this.subscriptionShims.set(t,this.subscriptionShims.get(t).concat([e])):this.subscriptionShims.set(t,[e]),this.doc.subscribe(e)}unsubscribe(t){this.subscriptionShims.has(t)&&(this.subscriptionShims.get(t).forEach(t=>this.doc.unsubscribe(t)),this.subscriptionShims.delete(t))}getData(){try{return this.doc.traverse(this.path)}catch(t){return null}}doSubmitOp(t,e=!0){return i(this,void 0,void 0,function*(){const n=t.map(t=>s.extend({},t,{p:this.path.concat(t.p)}));return yield this.doc.submitOp(n,e),this})}traverse(t){return this.doc.traverse(this.path.concat(t))}}},function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(r,o){function s(t){try{u(i.next(t))}catch(t){o(t)}}function a(t){try{u(i.throw(t))}catch(t){o(t)}}function u(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(s,a)}u((i=i.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});e.OpSubmittable=class{constructor(){}submitObjectReplaceOp(t,e,n=this.traverse(t)){return i(this,void 0,void 0,function*(){return yield this.submitOp([{p:t,oi:e,od:n}])})}submitObjectInsertOp(t,e){return i(this,void 0,void 0,function*(){return yield this.submitOp([{p:t,oi:e}])})}submitObjectDeleteOp(t,e=this.traverse(t)){return i(this,void 0,void 0,function*(){return yield this.submitOp([{p:t,od:e}])})}submitListReplaceOp(t,e,n=this.traverse(t)){return i(this,void 0,void 0,function*(){return yield this.submitOp([{p:t,li:e,ld:n}])})}submitListInsertOp(t,e){return i(this,void 0,void 0,function*(){return yield this.submitOp([{p:t,li:e}])})}submitListDeleteOp(t,e=this.traverse(t)){return i(this,void 0,void 0,function*(){return yield this.submitOp([{p:t,ld:e}])})}submitNumberAddOp(t,e){return i(this,void 0,void 0,function*(){return yield this.submitOp([{p:t,na:e}])})}submitListSpliceOp(t,e,n,...r){return i(this,void 0,void 0,function*(){const i=[],o=this.traverse(t);for(let r=e+n-1;r>=e;r--){const e=t.concat([r]);i.push({p:e,ld:o[r]})}const s=r.map((n,i)=>({p:t.concat([e+i]),li:n})),a=Array.prototype.concat(i,s);return yield this.submitOp(a)})}submitListPushOp(t,...e){return i(this,void 0,void 0,function*(){const n=this.traverse(t).length,i=e.map((e,i)=>({p:t.concat(n+i),li:e}));return yield this.submitOp(i)})}submitListUnshiftOp(t,...e){return i(this,void 0,void 0,function*(){const n=e.map((e,n)=>({p:t.concat(n),li:e}));return yield this.submitOp(n)})}submitOp(t,e){return this.doSubmitOp(t,e)}}},function(t,e,n){(function(n,i,r){var o;
/*!
 * async
 * https://github.com/caolan/async
 *
 * Copyright 2010-2014 Caolan McMahon
 * Released under the MIT license
 */
/*!
 * async
 * https://github.com/caolan/async
 *
 * Copyright 2010-2014 Caolan McMahon
 * Released under the MIT license
 */
!function(){var s,a={};function u(){}function c(t){return t}function l(t){return!!t}function h(t){return!t}var f="object"==typeof self&&self.self===self&&self||"object"==typeof n&&n.global===n&&n||this;function p(t){return function(){if(null===t)throw new Error("Callback was already called.");t.apply(this,arguments),t=null}}function d(t){return function(){null!==t&&(t.apply(this,arguments),t=null)}}null!=f&&(s=f.async),a.noConflict=function(){return f.async=s,a};var y=Object.prototype.toString,g=Array.isArray||function(t){return"[object Array]"===y.call(t)};function v(t){return g(t)||"number"==typeof t.length&&t.length>=0&&t.length%1==0}function b(t,e){for(var n=-1,i=t.length;++n<i;)e(t[n],n,t)}function m(t,e){for(var n=-1,i=t.length,r=Array(i);++n<i;)r[n]=e(t[n],n,t);return r}function w(t){return m(Array(t),function(t,e){return e})}function _(t,e){for(var n=0;n<t.length;n++)if(t[n]===e)return n;return-1}var S=Object.keys||function(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(n);return e};function k(t){var e,n,i=-1;return v(t)?(e=t.length,function(){return++i<e?i:null}):(n=S(t),e=n.length,function(){return++i<e?n[i]:null})}function O(t,e){return e=null==e?t.length-1:+e,function(){for(var n=Math.max(arguments.length-e,0),i=Array(n),r=0;r<n;r++)i[r]=arguments[r+e];switch(e){case 0:return t.call(this,i);case 1:return t.call(this,arguments[0],i)}}}function E(t){return function(e,n,i){return t(e,i)}}var x="function"==typeof i&&i,D=x?function(t){x(t)}:function(t){setTimeout(t,0)};function T(t){return function(e,n,i){i=d(i||u);var r=k(e=e||[]);if(t<=0)return i(null);var o=!1,s=0,a=!1;!function u(){if(o&&s<=0)return i(null);for(;s<t&&!a;){var c=r();if(null===c)return o=!0,void(s<=0&&i(null));s+=1,n(e[c],c,p(function(t){s-=1,t?(i(t),a=!0):u()}))}}()}}function P(t){return function(e,n,i){return t(a.eachOf,e,n,i)}}function A(t){return function(e,n,i,r){return t(T(n),e,i,r)}}function R(t){return function(e,n,i){return t(a.eachOfSeries,e,n,i)}}function M(t,e,n,i){i=d(i||u);var r=v(e=e||[])?[]:{};t(e,function(t,e,i){n(t,function(t,n){r[e]=n,i(t)})},function(t){i(t,r)})}function j(t,e,n,i){var r=[];t(e,function(t,e,i){n(t,function(n){n&&r.push({index:e,value:t}),i()})},function(){i(m(r.sort(function(t,e){return t.index-e.index}),function(t){return t.value}))})}function I(t,e,n,i){j(t,e,function(t,e){n(t,function(t){e(!t)})},i)}function C(t,e,n){return function(i,r,o,s){function a(){s&&s(n(!1,void 0))}function u(t,i,r){if(!s)return r();o(t,function(i){s&&e(i)&&(s(n(!0,t)),s=o=!1),r()})}arguments.length>3?t(i,r,u,a):(s=o,o=r,t(i,u,a))}}function q(t,e){return e}function B(t,e,n){n=n||u;var i=v(e)?[]:{};t(e,function(t,e,n){t(O(function(t,r){r.length<=1&&(r=r[0]),i[e]=r,n(t)}))},function(t){n(t,i)})}function L(t,e,n,i){var r=[];t(e,function(t,e,i){n(t,function(t,e){r=r.concat(e||[]),i(t)})},function(t){i(t,r)})}function N(t,e,n){if(null==e)e=1;else if(0===e)throw new Error("Concurrency must not be zero");function i(t,e,n,i){if(null!=i&&"function"!=typeof i)throw new Error("task callback must be a function");if(t.started=!0,g(e)||(e=[e]),0===e.length&&t.idle())return a.setImmediate(function(){t.drain()});b(e,function(e){var r={data:e,callback:i||u};n?t.tasks.unshift(r):t.tasks.push(r),t.tasks.length===t.concurrency&&t.saturated()}),a.setImmediate(t.process)}function r(t,e){return function(){o-=1;var n=!1,i=arguments;b(e,function(t){b(s,function(e,i){e!==t||n||(s.splice(i,1),n=!0)}),t.callback.apply(t,i)}),t.tasks.length+o===0&&t.drain(),t.process()}}var o=0,s=[],c={tasks:[],concurrency:e,payload:n,saturated:u,empty:u,drain:u,started:!1,paused:!1,push:function(t,e){i(c,t,!1,e)},kill:function(){c.drain=u,c.tasks=[]},unshift:function(t,e){i(c,t,!0,e)},process:function(){for(;!c.paused&&o<c.concurrency&&c.tasks.length;){var e=c.payload?c.tasks.splice(0,c.payload):c.tasks.splice(0,c.tasks.length),n=m(e,function(t){return t.data});0===c.tasks.length&&c.empty(),o+=1,s.push(e[0]);var i=p(r(c,e));t(n,i)}},length:function(){return c.tasks.length},running:function(){return o},workersList:function(){return s},idle:function(){return c.tasks.length+o===0},pause:function(){c.paused=!0},resume:function(){if(!1!==c.paused){c.paused=!1;for(var t=Math.min(c.concurrency,c.tasks.length),e=1;e<=t;e++)a.setImmediate(c.process)}}};return c}function U(t){return O(function(e,n){e.apply(null,n.concat([O(function(e,n){"object"==typeof console&&(e?console.error&&console.error(e):console[t]&&b(n,function(e){console[t](e)}))})]))})}function F(t){return function(e,n,i){t(w(e),n,i)}}function z(t){return O(function(e,n){var i=O(function(n){var i=this,r=n.pop();return t(e,function(t,e,r){t.apply(i,n.concat([r]))},r)});return n.length?i.apply(this,n):i})}function W(t){return O(function(e){var n=e.pop();e.push(function(){var t=arguments;i?a.setImmediate(function(){n.apply(null,t)}):n.apply(null,t)});var i=!0;t.apply(this,e),i=!1})}"object"==typeof r&&"function"==typeof r.nextTick?a.nextTick=r.nextTick:a.nextTick=D,a.setImmediate=x?D:a.nextTick,a.forEach=a.each=function(t,e,n){return a.eachOf(t,E(e),n)},a.forEachSeries=a.eachSeries=function(t,e,n){return a.eachOfSeries(t,E(e),n)},a.forEachLimit=a.eachLimit=function(t,e,n,i){return T(e)(t,E(n),i)},a.forEachOf=a.eachOf=function(t,e,n){n=d(n||u);for(var i,r=k(t=t||[]),o=0;null!=(i=r());)o+=1,e(t[i],i,p(s));function s(t){o--,t?n(t):null===i&&o<=0&&n(null)}0===o&&n(null)},a.forEachOfSeries=a.eachOfSeries=function(t,e,n){n=d(n||u);var i=k(t=t||[]),r=i();!function o(){var s=!0;if(null===r)return n(null);e(t[r],r,p(function(t){if(t)n(t);else{if(null===(r=i()))return n(null);s?a.setImmediate(o):o()}})),s=!1}()},a.forEachOfLimit=a.eachOfLimit=function(t,e,n,i){T(e)(t,n,i)},a.map=P(M),a.mapSeries=R(M),a.mapLimit=A(M),a.inject=a.foldl=a.reduce=function(t,e,n,i){a.eachOfSeries(t,function(t,i,r){n(e,t,function(t,n){e=n,r(t)})},function(t){i(t,e)})},a.foldr=a.reduceRight=function(t,e,n,i){var r=m(t,c).reverse();a.reduce(r,e,n,i)},a.transform=function(t,e,n,i){3===arguments.length&&(i=n,n=e,e=g(t)?[]:{}),a.eachOf(t,function(t,i,r){n(e,t,i,r)},function(t){i(t,e)})},a.select=a.filter=P(j),a.selectLimit=a.filterLimit=A(j),a.selectSeries=a.filterSeries=R(j),a.reject=P(I),a.rejectLimit=A(I),a.rejectSeries=R(I),a.any=a.some=C(a.eachOf,l,c),a.someLimit=C(a.eachOfLimit,l,c),a.all=a.every=C(a.eachOf,h,h),a.everyLimit=C(a.eachOfLimit,h,h),a.detect=C(a.eachOf,c,q),a.detectSeries=C(a.eachOfSeries,c,q),a.detectLimit=C(a.eachOfLimit,c,q),a.sortBy=function(t,e,n){function i(t,e){var n=t.criteria,i=e.criteria;return n<i?-1:n>i?1:0}a.map(t,function(t,n){e(t,function(e,i){e?n(e):n(null,{value:t,criteria:i})})},function(t,e){if(t)return n(t);n(null,m(e.sort(i),function(t){return t.value}))})},a.auto=function(t,e,n){"function"==typeof arguments[1]&&(n=e,e=null),n=d(n||u);var i=S(t),r=i.length;if(!r)return n(null);e||(e=r);var o={},s=0,c=!1,l=[];function h(t){l.unshift(t)}function f(){r--,b(l.slice(0),function(t){t()})}h(function(){r||n(null,o)}),b(i,function(i){if(!c){for(var r,u=g(t[i])?t[i]:[t[i]],p=O(function(t,e){if(s--,e.length<=1&&(e=e[0]),t){var r={};!function(t,e){b(S(t),function(n){e(t[n],n)})}(o,function(t,e){r[e]=t}),r[i]=e,c=!0,n(t,r)}else o[i]=e,a.setImmediate(f)}),d=u.slice(0,u.length-1),y=d.length;y--;){if(!(r=t[d[y]]))throw new Error("Has nonexistent dependency in "+d.join(", "));if(g(r)&&_(r,i)>=0)throw new Error("Has cyclic dependencies")}v()?(s++,u[u.length-1](p,o)):h(function t(){v()&&(s++,function(t){var e=_(l,t);e>=0&&l.splice(e,1)}(t),u[u.length-1](p,o))})}function v(){return s<e&&function(t,e,n){return b(t,function(t,i,r){n=e(n,t,i,r)}),n}(d,function(t,e){return t&&o.hasOwnProperty(e)},!0)&&!o.hasOwnProperty(i)}})},a.retry=function(t,e,n){var i=5,r=0,o=[],s={times:i,interval:r};var u=arguments.length;if(u<1||u>3)throw new Error("Invalid arguments - must be either (task), (task, callback), (times, task) or (times, task, callback)");function c(t,e){function n(t,n){return function(i){t(function(t,e){i(!t||n,{err:t,result:e})},e)}}function i(t){return function(e){setTimeout(function(){e(null)},t)}}for(;s.times;){var r=!(s.times-=1);o.push(n(s.task,r)),!r&&s.interval>0&&o.push(i(s.interval))}a.series(o,function(e,n){n=n[n.length-1],(t||s.callback)(n.err,n.result)})}return u<=2&&"function"==typeof t&&(n=e,e=t),"function"!=typeof t&&function(t,e){if("number"==typeof e)t.times=parseInt(e,10)||i;else{if("object"!=typeof e)throw new Error("Unsupported argument type for 'times': "+typeof e);t.times=parseInt(e.times,10)||i,t.interval=parseInt(e.interval,10)||r}}(s,t),s.callback=n,s.task=e,s.callback?c():c},a.waterfall=function(t,e){if(e=d(e||u),!g(t)){var n=new Error("First argument to waterfall must be an array of functions");return e(n)}if(!t.length)return e();!function t(n){return O(function(i,r){if(i)e.apply(null,[i].concat(r));else{var o=n.next();o?r.push(t(o)):r.push(e),W(n).apply(null,r)}})}(a.iterator(t))()},a.parallel=function(t,e){B(a.eachOf,t,e)},a.parallelLimit=function(t,e,n){B(T(e),t,n)},a.series=function(t,e){B(a.eachOfSeries,t,e)},a.iterator=function(t){return function e(n){function i(){return t.length&&t[n].apply(null,arguments),i.next()}return i.next=function(){return n<t.length-1?e(n+1):null},i}(0)},a.apply=O(function(t,e){return O(function(n){return t.apply(null,e.concat(n))})}),a.concat=P(L),a.concatSeries=R(L),a.whilst=function(t,e,n){if(n=n||u,t()){var i=O(function(r,o){r?n(r):t.apply(this,o)?e(i):n.apply(null,[null].concat(o))});e(i)}else n(null)},a.doWhilst=function(t,e,n){var i=0;return a.whilst(function(){return++i<=1||e.apply(this,arguments)},t,n)},a.until=function(t,e,n){return a.whilst(function(){return!t.apply(this,arguments)},e,n)},a.doUntil=function(t,e,n){return a.doWhilst(t,function(){return!e.apply(this,arguments)},n)},a.during=function(t,e,n){n=n||u;var i=O(function(e,i){e?n(e):(i.push(r),t.apply(this,i))}),r=function(t,r){t?n(t):r?e(i):n(null)};t(r)},a.doDuring=function(t,e,n){var i=0;a.during(function(t){i++<1?t(null,!0):e.apply(this,arguments)},t,n)},a.queue=function(t,e){return N(function(e,n){t(e[0],n)},e,1)},a.priorityQueue=function(t,e){function n(t,e){return t.priority-e.priority}var i=a.queue(t,e);return i.push=function(t,e,r){!function(t,e,i,r){if(null!=r&&"function"!=typeof r)throw new Error("task callback must be a function");if(t.started=!0,g(e)||(e=[e]),0===e.length)return a.setImmediate(function(){t.drain()});b(e,function(e){var o={data:e,priority:i,callback:"function"==typeof r?r:u};t.tasks.splice(function(t,e,n){for(var i=-1,r=t.length-1;i<r;){var o=i+(r-i+1>>>1);n(e,t[o])>=0?i=o:r=o-1}return i}(t.tasks,o,n)+1,0,o),t.tasks.length===t.concurrency&&t.saturated(),a.setImmediate(t.process)})}(i,t,e,r)},delete i.unshift,i},a.cargo=function(t,e){return N(t,1,e)},a.log=U("log"),a.dir=U("dir"),a.memoize=function(t,e){var n={},i={},r=Object.prototype.hasOwnProperty;e=e||c;var o=O(function(o){var s=o.pop(),u=e.apply(null,o);r.call(n,u)?a.setImmediate(function(){s.apply(null,n[u])}):r.call(i,u)?i[u].push(s):(i[u]=[s],t.apply(null,o.concat([O(function(t){n[u]=t;var e=i[u];delete i[u];for(var r=0,o=e.length;r<o;r++)e[r].apply(null,t)})])))});return o.memo=n,o.unmemoized=t,o},a.unmemoize=function(t){return function(){return(t.unmemoized||t).apply(null,arguments)}},a.times=F(a.map),a.timesSeries=F(a.mapSeries),a.timesLimit=function(t,e,n,i){return a.mapLimit(w(t),e,n,i)},a.seq=function(){var t=arguments;return O(function(e){var n=this,i=e[e.length-1];"function"==typeof i?e.pop():i=u,a.reduce(t,e,function(t,e,i){e.apply(n,t.concat([O(function(t,e){i(t,e)})]))},function(t,e){i.apply(n,[t].concat(e))})})},a.compose=function(){return a.seq.apply(null,Array.prototype.reverse.call(arguments))},a.applyEach=z(a.eachOf),a.applyEachSeries=z(a.eachOfSeries),a.forever=function(t,e){var n=p(e||u),i=W(t);!function t(e){if(e)return n(e);i(t)}()},a.ensureAsync=W,a.constant=O(function(t){var e=[null].concat(t);return function(t){return t.apply(this,e)}}),a.wrapSync=a.asyncify=function(t){return O(function(e){var n,i=e.pop();try{n=t.apply(this,e)}catch(t){return i(t)}!function(t){var e=typeof t;return"function"===e||"object"===e&&!!t}(n)||"function"!=typeof n.then?i(null,n):n.then(function(t){i(null,t)}).catch(function(t){i(t.message?t:new Error(t))})})},"object"==typeof t&&t.exports?t.exports=a:void 0===(o=function(){return a}.apply(e,[]))||(t.exports=o)}()}).call(this,n(2),n(23).setImmediate,n(0))},function(t,e,n){(function(t){var i=void 0!==t&&t||"undefined"!=typeof self&&self||window,r=Function.prototype.apply;function o(t,e){this._id=t,this._clearFn=e}e.setTimeout=function(){return new o(r.call(setTimeout,i,arguments),clearTimeout)},e.setInterval=function(){return new o(r.call(setInterval,i,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(i,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout(function(){t._onTimeout&&t._onTimeout()},e))},n(51),e.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,e.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(this,n(2))},function(t,e,n){(function(e){var i=n(52),r=n(3),o=n(4);function s(t,e){this.backend=t,this.stream=e,this.clientId=i(),this.connectTime=Date.now(),this.subscribedDocs={},this.subscribedQueries={},this.closed=!1,this.custom={},this.send({a:"init",protocol:1,id:this.clientId,type:o.defaultType.uri})}function a(t){var e,n,i,r=t.r;if(r){e=[];for(var o=0;o<r.length;o++){var s=r[o],a=s[0],u=s[1];e.push(a),null==u?n?n.push(a):n=[a]:(i||(i={}),i[a]=u)}}var c=t.o||{};return c.ids=e,c.fetch=n,c.fetchOps=i,c}function u(t){for(var e=[],n=0;n<t.length;n++){var i=t[n],r=l(i);r.d=i.id,e.push(r)}return e}function c(t){var e={};for(var n in t)e[n]=l(t[n]);return e}function l(t){var e={v:t.v,data:t.data};return o.defaultType!==o.map[t.type]&&(e.type=t.type),e}t.exports=s,s.prototype.close=function(t){t&&console.warn("Agent closed due to error",this.clientId,t.stack||t),this.closed||this.stream.end()},s.prototype._cleanup=function(){for(var t in this.closed=!0,this.subscribedDocs){var e=this.subscribedDocs[t];for(var n in e){e[n].destroy()}}for(var n in this.subscribedDocs={},this.subscribedQueries){this.subscribedQueries[n].destroy()}this.subscribedQueries={}},s.prototype._subscribeToStream=function(t,e,n){if(this.closed)return n.destroy();var i=this.subscribedDocs[t]||(this.subscribedDocs[t]={}),o=i[e];o&&o.destroy(),i[e]=n;var s=this;n.on("data",function(n){n.error?console.error("Doc subscription stream error",t,e,n.error):s._isOwnOp(t,n)||s._sendOp(t,e,n)}),n.on("end",function(){var n=s.subscribedDocs[t];n&&(delete n[e],r.hasKeys(n)||delete s.subscribedDocs[t])})},s.prototype._subscribeToQuery=function(t,e,n,i){var r=this.subscribedQueries[e];r&&r.destroy(),this.subscribedQueries[e]=t;var o=this;t.onExtra=function(t){o.send({a:"q",id:e,extra:t})},t.onDiff=function(t){for(var n=0;n<t.length;n++){var i=t[n];"insert"===i.type&&(i.values=u(i.values))}o.send({a:"q",id:e,diff:t})},t.onError=function(t){console.error("Query subscription stream error",n,i,t)},t.onOp=function(t){var e=t.d;o._isOwnOp(n,t)||o._sendOp(n,e,t)},t._open()},s.prototype._isOwnOp=function(t,e){return this.clientId===e.src&&t===(e.i||e.c)},s.prototype.send=function(t){this.closed||(this.backend.emit("send",this,t),this.stream.write(t))},s.prototype._sendOp=function(t,e,n){var i={a:"op",c:t,d:e,v:n.v,src:n.src,seq:n.seq};n.op&&(i.op=n.op),n.create&&(i.create=n.create),n.del&&(i.del=!0),this.send(i)},s.prototype._sendOps=function(t,e,n){for(var i=0;i<n.length;i++)this._sendOp(t,e,n[i])},s.prototype._reply=function(t,e,n){if(e)return"string"==typeof e?t.error={code:4001,message:e}:(e.stack&&console.warn(e.stack),t.error={code:e.code,message:e.message}),void this.send(t);n||(n={}),n.a=t.a,t.id?n.id=t.id:(t.c&&(n.c=t.c),t.d&&(n.d=t.d),t.b&&!n.data&&(n.b=t.b)),this.send(n)},s.prototype._open=function(){if(!this.closed){this.backend.agentsCount++,this.stream.isServer||this.backend.remoteAgentsCount++;var t=this;this.stream.on("data",function(e){if(!t.closed){if("object"!=typeof e){return t.close({code:4e3,message:"Received non-object message"})}var n={data:e};t.backend.trigger("receive",t,n,function(e){var i=function(e,i){t._reply(n.data,e,i)};if(e)return i(e);t._handleMessage(n.data,i)})}}),this.stream.on("end",function(){t.backend.agentsCount--,t.stream.isServer||t.backend.remoteAgentsCount--,t._cleanup()})}},s.prototype._checkRequest=function(t){if("qf"===t.a||"qs"===t.a||"qu"===t.a){if("number"!=typeof t.id)return"Missing query ID"}else if("op"===t.a||"f"===t.a||"s"===t.a||"u"===t.a){if(null!=t.c&&"string"!=typeof t.c)return"Invalid collection";if(null!=t.d&&"string"!=typeof t.d)return"Invalid id";if("op"===t.a&&null!=t.v&&("number"!=typeof t.v||t.v<0))return"Invalid version"}else if("bf"===t.a||"bs"===t.a||"bu"===t.a){if(null!=t.c&&"string"!=typeof t.c)return"Invalid collection";if("object"!=typeof t.b)return"Invalid bulk subscribe data"}},s.prototype._handleMessage=function(t,e){try{var n=this._checkRequest(t);if(n)return e({code:4e3,message:n});switch(t.a){case"qf":return this._queryFetch(t.id,t.c,t.q,a(t),e);case"qs":return this._querySubscribe(t.id,t.c,t.q,a(t),e);case"qu":return this._queryUnsubscribe(t.id,e);case"bf":return this._fetchBulk(t.c,t.b,e);case"bs":return this._subscribeBulk(t.c,t.b,e);case"bu":return this._unsubscribeBulk(t.c,t.b,e);case"f":return this._fetch(t.c,t.d,t.v,e);case"s":return this._subscribe(t.c,t.d,t.v,e);case"u":return this._unsubscribe(t.c,t.d,e);case"op":var i=this._createOp(t);return i?this._submit(t.c,t.d,i,e):e({code:4e3,message:"Invalid op message"});case"nf":return this._fetchSnapshot(t.c,t.d,t.v,e);default:e({code:4e3,message:"Invalid or unknown message"})}}catch(t){e(t)}},s.prototype._queryFetch=function(t,e,n,i,r){this.backend.queryFetch(this,e,n,i,function(t,e,n){if(t)return r(t);var i={data:u(e),extra:n};r(null,i)})},s.prototype._querySubscribe=function(t,e,n,i,r){var o,s=this,a=1;function l(t){if(t)return r(t);--a||r(null,o)}i.fetch&&(a++,this.backend.fetchBulk(this,e,i.fetch,function(t,e){if(t)return l(t);o={data:c(e)},l()})),i.fetchOps&&(a++,this._fetchBulkOps(e,i.fetchOps,l)),this.backend.querySubscribe(this,e,n,i,function(i,r,a,c){return i?l(i):this.closed?r.destroy():(s._subscribeToQuery(r,t,e,n),void(a?(o={data:u(a),extra:c},l()):r.queryPoll(l)))})},s.prototype._queryUnsubscribe=function(t,n){var i=this.subscribedQueries[t];i&&(i.destroy(),delete this.subscribedQueries[t]),e.nextTick(n)},s.prototype._fetch=function(t,e,n,i){null==n?this.backend.fetch(this,t,e,function(t,e){if(t)return i(t);i(null,{data:l(e)})}):this._fetchOps(t,e,n,i)},s.prototype._fetchOps=function(t,e,n,i){var r=this;this.backend.getOps(this,t,e,n,null,function(n,o){if(n)return i(n);r._sendOps(t,e,o),i()})},s.prototype._fetchBulk=function(t,e,n){Array.isArray(e)?this.backend.fetchBulk(this,t,e,function(t,e){if(t)return n(t);n(null,{data:c(e)})}):this._fetchBulkOps(t,e,n)},s.prototype._fetchBulkOps=function(t,e,n){var i=this;this.backend.getOpsBulk(this,t,e,null,function(e,r){if(e)return n(e);for(var o in r){var s=r[o];i._sendOps(t,o,s)}n()})},s.prototype._subscribe=function(t,e,n,i){var r=this;this.backend.subscribe(this,t,e,n,function(n,o,s){if(n)return i(n);r._subscribeToStream(t,e,o),s?i(null,{data:l(s)}):i()})},s.prototype._subscribeBulk=function(t,e,n){var i=this;this.backend.subscribeBulk(this,t,e,function(e,r,o){if(e)return n(e);for(var s in r)i._subscribeToStream(t,s,r[s]);o?n(null,{data:c(o)}):n()})},s.prototype._unsubscribe=function(t,n,i){var r=this.subscribedDocs[t],o=r&&r[n];o&&o.destroy(),e.nextTick(i)},s.prototype._unsubscribeBulk=function(t,n,i){var r=this.subscribedDocs[t];if(!r)return e.nextTick(i);for(var o=0;o<n.length;o++){var s=r[n[o]];s&&s.destroy()}e.nextTick(i)},s.prototype._submit=function(t,e,n,i){var r=this;this.backend.submit(this,t,e,n,null,function(o,s){var a={src:n.src,seq:n.seq,v:n.v};if(o)return 4001===o.code?i(null,a):i(o);r._sendOps(t,e,s),i(null,a)})},s.prototype._createOp=function(t){var e=t.src||this.clientId;return t.op?new function(t,e,n,i){this.src=t,this.seq=e,this.v=n,this.op=i,this.m=null}(e,t.seq,t.v,t.op):t.create?new function(t,e,n,i){this.src=t,this.seq=e,this.v=n,this.create=i,this.m=null}(e,t.seq,t.v,t.create):t.del?new function(t,e,n,i){this.src=t,this.seq=e,this.v=n,this.del=i,this.m=null}(e,t.seq,t.v,t.del):void 0},s.prototype._fetchSnapshot=function(t,e,n,i){this.backend.fetchSnapshot(this,t,e,n,i)}}).call(this,n(0))},function(t,e,n){t.exports={type:n(53)}},function(t,e){t.exports=function(t,e,n,i){var r=function(t,n,i,r){e(i,t,n,"left"),e(r,n,t,"right")},o=t.transformX=function(t,e){n(t),n(e);for(var s=[],a=0;a<e.length;a++){for(var u=e[a],c=[],l=0;l<t.length;){var h=[];if(r(t[l],u,c,h),l++,1!==h.length){if(0===h.length){for(var f=l;f<t.length;f++)i(c,t[f]);u=null;break}for(var p=o(t.slice(l),h),d=0;d<p[0].length;d++)i(c,p[0][d]);for(var y=0;y<p[1].length;y++)i(s,p[1][y]);u=null;break}u=h[0]}null!=u&&i(s,u),t=c}return[t,s]};t.transform=function(t,n,i){if("left"!==i&&"right"!==i)throw new Error("type must be 'left' or 'right'");return 0===n.length?t:1===t.length&&1===n.length?e([],t[0],n[0],i):"left"===i?o(t,n)[0]:o(n,t)[1]}}},function(t,e,n){(function(e){var i=n(28),r=n(29),o=n(56),s=n(5),a=n(1),u=n(4),c=n(3);function l(t){return 0===t.readyState||1===t.readyState?"connecting":"disconnected"}function h(t){s.EventEmitter.call(this),this.collections={},this.nextQueryId=1,this.nextSnapshotRequestId=1,this.queries={},this._snapshotRequests={},this.seq=1,this.id=null,this.agent=null,this.debug=!1,this.state=l(t),this.bindToSocket(t)}function f(t){return t.hasPending()}function p(t){return t.hasWritePending()}t.exports=h,s.mixin(h),h.prototype.bindToSocket=function(t){this.socket&&(this.socket.close(),this.socket.onmessage=null,this.socket.onopen=null,this.socket.onerror=null,this.socket.onclose=null),this.socket=t;var n=l(t);this._setState(n),this.canSend=!1;var i=this;t.onmessage=function(t){try{var n="string"==typeof t.data?JSON.parse(t.data):t.data}catch(e){return void console.warn("Failed to parse message",t)}i.debug&&console.log("RECV",JSON.stringify(n));var r={data:n};if(i.emit("receive",r),r.data)try{i.handleMessage(r.data)}catch(t){e.nextTick(function(){i.emit("error",t)})}},t.onopen=function(){i._setState("connecting")},t.onerror=function(t){i.emit("connection error",t)},t.onclose=function(t){"closed"===t||"Closed"===t?i._setState("closed",t):"stopped"===t||"Stopped by server"===t?i._setState("stopped",t):i._setState("disconnected",t)}},h.prototype.handleMessage=function(t){var e=null;switch(t.error&&((e=new Error(t.error.message)).code=t.error.code,e.data=t,delete t.error),t.a){case"init":return 1!==t.protocol?(e=new a(4019,"Invalid protocol version"),this.emit("error",e)):u.map[t.type]!==u.defaultType?(e=new a(4020,"Invalid default type"),this.emit("error",e)):"string"!=typeof t.id?(e=new a(4021,"Invalid client id"),this.emit("error",e)):(this.id=t.id,void this._setState("connected"));case"qf":return void((n=this.queries[t.id])&&n._handleFetch(e,t.data,t.extra));case"qs":return void((n=this.queries[t.id])&&n._handleSubscribe(e,t.data,t.extra));case"qu":return;case"q":var n;if(!(n=this.queries[t.id]))return;return e?n._handleError(e):(t.diff&&n._handleDiff(t.diff),void(t.hasOwnProperty("extra")&&n._handleExtra(t.extra)));case"bf":return this._handleBulkMessage(t,"_handleFetch");case"bs":return this._handleBulkMessage(t,"_handleSubscribe");case"bu":return this._handleBulkMessage(t,"_handleUnsubscribe");case"nf":return this._handleSnapshotFetch(e,t);case"f":return void((i=this.getExisting(t.c,t.d))&&i._handleFetch(e,t.data));case"s":return void((i=this.getExisting(t.c,t.d))&&i._handleSubscribe(e,t.data));case"u":return void((i=this.getExisting(t.c,t.d))&&i._handleUnsubscribe(e));case"op":var i;return void((i=this.getExisting(t.c,t.d))&&i._handleOp(e,t));default:console.warn("Ignoring unrecognized message",t)}},h.prototype._handleBulkMessage=function(t,e){if(t.data)for(var n in t.data){(r=this.getExisting(t.c,n))&&r[e](t.error,t.data[n])}else if(Array.isArray(t.b))for(var i=0;i<t.b.length;i++){n=t.b[i];(r=this.getExisting(t.c,n))&&r[e](t.error)}else if(t.b)for(var n in t.b){var r;(r=this.getExisting(t.c,n))&&r[e](t.error)}else console.error("Invalid bulk message",t)},h.prototype._reset=function(){this.seq=1,this.id=null,this.agent=null},h.prototype._setState=function(t,e){if(this.state!==t){if("connecting"===t&&"disconnected"!==this.state&&"stopped"!==this.state&&"closed"!==this.state||"connected"===t&&"connecting"!==this.state){var n=new a(5007,"Cannot transition directly from "+this.state+" to "+t);return this.emit("error",n)}for(var i in this.state=t,this.canSend="connected"===t,"disconnected"!==t&&"stopped"!==t&&"closed"!==t||this._reset(),this.startBulk(),this.queries){this.queries[i]._onConnectionStateChanged()}for(var r in this.collections){var o=this.collections[r];for(var i in o)o[i]._onConnectionStateChanged()}for(var i in this._snapshotRequests){this._snapshotRequests[i]._onConnectionStateChanged()}this.endBulk(),this.emit(t,e),this.emit("state",t,e)}},h.prototype.startBulk=function(){this.bulk||(this.bulk={})},h.prototype.endBulk=function(){if(this.bulk)for(var t in this.bulk){var e=this.bulk[t];this._sendBulk("f",t,e.f),this._sendBulk("s",t,e.s),this._sendBulk("u",t,e.u)}this.bulk=null},h.prototype._sendBulk=function(t,e,n){if(n){var i,r=[],o={},s=0;for(var a in n){var u=n[a];null==u?r.push(a):(o[a]=u,i=a,s++)}if(1===r.length){a=r[0];this.send({a:t,c:e,d:a})}else r.length&&this.send({a:"b"+t,c:e,b:r});if(1===s){var c=o[i];this.send({a:t,c:e,d:i,v:c})}else s&&this.send({a:"b"+t,c:e,b:o})}},h.prototype._sendAction=function(t,e,n){if(this._addDoc(e),this.bulk){var i=this.bulk[e.collection]||(this.bulk[e.collection]={}),r=i[t]||(i[t]={}),o=r.hasOwnProperty(e.id);return r[e.id]=n,o}var s={a:t,c:e.collection,d:e.id,v:n};this.send(s)},h.prototype.sendFetch=function(t){return this._sendAction("f",t,t.version)},h.prototype.sendSubscribe=function(t){return this._sendAction("s",t,t.version)},h.prototype.sendUnsubscribe=function(t){return this._sendAction("u",t)},h.prototype.sendOp=function(t,e){this._addDoc(t);var n={a:"op",c:t.collection,d:t.id,v:t.version,src:e.src,seq:e.seq};e.op&&(n.op=e.op),e.create&&(n.create=e.create),e.del&&(n.del=e.del),this.send(n)},h.prototype.send=function(t){this.debug&&console.log("SEND",JSON.stringify(t)),this.emit("send",t),this.socket.send(JSON.stringify(t))},h.prototype.close=function(){this.socket.close()},h.prototype.getExisting=function(t,e){if(this.collections[t])return this.collections[t][e]},h.prototype.get=function(t,e){var n=this.collections[t]||(this.collections[t]={}),r=n[e];return r||(r=n[e]=new i(this,t,e),this.emit("doc",r)),r},h.prototype._destroyDoc=function(t){var e=this.collections[t.collection];e&&(delete e[t.id],c.hasKeys(e)||delete this.collections[t.collection])},h.prototype._addDoc=function(t){var e=this.collections[t.collection];e||(e=this.collections[t.collection]={}),e[t.id]!==t&&(e[t.id]=t)},h.prototype._createQuery=function(t,e,n,i,o){var s=this.nextQueryId++,a=new r(t,this,s,e,n,i,o);return this.queries[s]=a,a.send(),a},h.prototype._destroyQuery=function(t){delete this.queries[t.id]},h.prototype.createFetchQuery=function(t,e,n,i){return this._createQuery("qf",t,e,n,i)},h.prototype.createSubscribeQuery=function(t,e,n,i){return this._createQuery("qs",t,e,n,i)},h.prototype.hasPending=function(){return!!(this._firstDoc(f)||this._firstQuery(f)||this._firstSnapshotRequest())},h.prototype.hasWritePending=function(){return!!this._firstDoc(p)},h.prototype.whenNothingPending=function(t){var n=this._firstDoc(f);if(n)n.once("nothing pending",this._nothingPendingRetry(t));else{var i=this._firstQuery(f);if(i)i.once("ready",this._nothingPendingRetry(t));else{var r=this._firstSnapshotRequest();r?r.once("ready",this._nothingPendingRetry(t)):e.nextTick(t)}}},h.prototype._nothingPendingRetry=function(t){var n=this;return function(){e.nextTick(function(){n.whenNothingPending(t)})}},h.prototype._firstDoc=function(t){for(var e in this.collections){var n=this.collections[e];for(var i in n){var r=n[i];if(t(r))return r}}},h.prototype._firstQuery=function(t){for(var e in this.queries){var n=this.queries[e];if(t(n))return n}},h.prototype._firstSnapshotRequest=function(){for(var t in this._snapshotRequests)return this._snapshotRequests[t]},h.prototype.fetchSnapshot=function(t,e,n,i){"function"==typeof n&&(i=n,n=null);var r=this.nextSnapshotRequestId++,s=new o(this,r,t,e,n,i);this._snapshotRequests[s.requestId]=s,s.send()},h.prototype._handleSnapshotFetch=function(t,e){var n=this._snapshotRequests[e.id];n&&(delete this._snapshotRequests[e.id],n._handleResponse(t,e))}}).call(this,n(0))},function(t,e,n){(function(e){var i=n(5),r=n(1),o=n(4);function s(t,e,n){i.EventEmitter.call(this),this.connection=t,this.collection=e,this.id=n,this.version=null,this.type=null,this.data=void 0,this.inflightFetch=[],this.inflightSubscribe=[],this.inflightUnsubscribe=[],this.pendingFetch=[],this.subscribed=!1,this.wantSubscribe=!1,this.inflightOp=null,this.pendingOps=[],this.type=null,this.applyStack=null,this.preventCompose=!1}function a(t,e,n){if(e){var i=t.pop();t.push(function(t){i&&i(t),n&&n(t)})}else t.push(n)}function u(t,e){if(t.del)return function(t){delete t.op,delete t.create,delete t.del}(e);if(e.del)return new r(4017,"Document was deleted");if(e.create)return new r(4018,"Document alredy created");if(e.op){if(t.create)return new r(4018,"Document already created");if(t.type.transformX){var n=t.type.transformX(t.op,e.op);t.op=n[0],e.op=n[1]}else{var i=t.type.transform(t.op,e.op,"left"),o=t.type.transform(e.op,t.op,"right");t.op=i,e.op=o}}}function c(t,e){for(var n=!1,i=0;i<t.length;i++){var r=t[i];r&&(r(e),n=!0)}return n}t.exports=s,i.mixin(s),s.prototype.destroy=function(t){var e=this;e.whenNothingPending(function(){e.wantSubscribe?e.unsubscribe(function(n){if(n)return t?t(n):e.emit("error",n);e.connection._destroyDoc(e),t&&t()}):(e.connection._destroyDoc(e),t&&t())})},s.prototype._setType=function(t){if("string"==typeof t&&(t=o.map[t]),t)this.type=t;else{if(null!==t){var e=new r(4008,"Missing type "+t);return this.emit("error",e)}this.type=t,this.data=void 0}},s.prototype.ingestSnapshot=function(t,e){if(!t)return e&&e();if("number"!=typeof t.v){var n=new r(5008,"Missing version in ingested snapshot. "+this.collection+"."+this.id);return e?e(n):this.emit("error",n)}if(this.type||this.hasWritePending()){if(null==this.version){if(this.hasWritePending())return e&&this.once("no write pending",e);n=new r(5009,"Cannot ingest snapshot in doc with null version. "+this.collection+"."+this.id);return e?e(n):this.emit("error",n)}return t.v>this.version?this.fetch(e):e&&e()}if(this.version>t.v)return e&&e();this.version=t.v;var i=void 0===t.type?o.defaultType:t.type;this._setType(i),this.data=this.type&&this.type.deserialize?this.type.deserialize(t.data):t.data,this.emit("load"),e&&e()},s.prototype.whenNothingPending=function(t){this.hasPending()?this.once("nothing pending",t):t()},s.prototype.hasPending=function(){return!!(this.inflightOp||this.pendingOps.length||this.inflightFetch.length||this.inflightSubscribe.length||this.inflightUnsubscribe.length||this.pendingFetch.length)},s.prototype.hasWritePending=function(){return!(!this.inflightOp&&!this.pendingOps.length)},s.prototype._emitNothingPending=function(){this.hasWritePending()||(this.emit("no write pending"),this.hasPending()||this.emit("nothing pending"))},s.prototype._emitResponseError=function(t,e){if(e)return e(t),void this._emitNothingPending();this._emitNothingPending(),this.emit("error",t)},s.prototype._handleFetch=function(t,e){var n=this.inflightFetch.shift();if(t)return this._emitResponseError(t,n);this.ingestSnapshot(e,n),this._emitNothingPending()},s.prototype._handleSubscribe=function(t,e){var n=this.inflightSubscribe.shift();if(t)return this._emitResponseError(t,n);this.wantSubscribe&&(this.subscribed=!0),this.ingestSnapshot(e,n),this._emitNothingPending()},s.prototype._handleUnsubscribe=function(t){var e=this.inflightUnsubscribe.shift();if(t)return this._emitResponseError(t,e);e&&e(),this._emitNothingPending()},s.prototype._handleOp=function(t,e){if(t)return this.inflightOp?(4002===t.code&&(t=null),this._rollback(t)):this.emit("error",t);if(this.inflightOp&&e.src===this.inflightOp.src&&e.seq===this.inflightOp.seq)this._opAcknowledged(e);else if(null==this.version||e.v>this.version)this.fetch();else if(!(e.v<this.version)){if(this.inflightOp)if(i=u(this.inflightOp,e))return this._hardRollback(i);for(var n=0;n<this.pendingOps.length;n++){var i;if(i=u(this.pendingOps[n],e))return this._hardRollback(i)}this.version++,this._otApply(e,!1)}},s.prototype._onConnectionStateChanged=function(){if(this.connection.canSend)this.flush(),this._resubscribe();else if(this.inflightOp&&(this.pendingOps.unshift(this.inflightOp),this.inflightOp=null),this.subscribed=!1,(this.inflightFetch.length||this.inflightSubscribe.length)&&(this.pendingFetch=this.pendingFetch.concat(this.inflightFetch,this.inflightSubscribe),this.inflightFetch.length=0,this.inflightSubscribe.length=0),this.inflightUnsubscribe.length){var t=this.inflightUnsubscribe;this.inflightUnsubscribe=[],c(t)}},s.prototype._resubscribe=function(){var t=this.pendingFetch;if(this.pendingFetch=[],this.wantSubscribe)return t.length?void this.subscribe(function(e){c(t,e)}):void this.subscribe();t.length&&this.fetch(function(e){c(t,e)})},s.prototype.fetch=function(t){if(this.connection.canSend){var e=this.connection.sendFetch(this);a(this.inflightFetch,e,t)}else this.pendingFetch.push(t)},s.prototype.subscribe=function(t){if(this.wantSubscribe=!0,this.connection.canSend){var e=this.connection.sendSubscribe(this);a(this.inflightSubscribe,e,t)}else this.pendingFetch.push(t)},s.prototype.unsubscribe=function(t){if(this.wantSubscribe=!1,this.subscribed=!1,this.connection.canSend){var n=this.connection.sendUnsubscribe(this);a(this.inflightUnsubscribe,n,t)}else t&&e.nextTick(t)},s.prototype.flush=function(){this.connection.canSend&&!this.inflightOp&&!this.paused&&this.pendingOps.length&&this._sendOp()},s.prototype._otApply=function(t,e){if(t.op){if(!this.type){var n=new r(4015,"Cannot apply op to uncreated document. "+this.collection+"."+this.id);return this.emit("error",n)}if(!e&&this.type===o.defaultType&&t.op.length>1){this.applyStack||(this.applyStack=[]);for(var i=this.applyStack.length,s=0;s<t.op.length;s++){for(var a={op:[t.op[s]]},c=i;c<this.applyStack.length;c++){var l=u(this.applyStack[c],a);if(l)return this._hardRollback(l)}this.emit("before op",a.op,e),this.data=this.type.apply(this.data,a.op),this.emit("op",a.op,e)}return void this._popApplyStack(i)}return this.emit("before op",t.op,e),this.data=this.type.apply(this.data,t.op),void this.emit("op",t.op,e)}if(t.create)return this._setType(t.create.type),this.data=this.type.deserialize?this.type.createDeserialized?this.type.createDeserialized(t.create.data):this.type.deserialize(this.type.create(t.create.data)):this.type.create(t.create.data),void this.emit("create",e);if(t.del){var h=this.data;return this._setType(null),void this.emit("del",h,e)}},s.prototype._sendOp=function(){var t=this.connection.id;if(t){this.inflightOp||(this.inflightOp=this.pendingOps.shift());var e=this.inflightOp;if(!e){var n=new r(5010,"No op to send on call to _sendOp");return this.emit("error",n)}e.sentAt=Date.now(),e.retries=null==e.retries?0:e.retries+1,null==e.seq&&(e.seq=this.connection.seq++),this.connection.sendOp(this,e),null==e.src&&(e.src=t)}},s.prototype._submit=function(t,n,i){if(n||(n=!0),t.op){if(!this.type){var o=new r(4015,"Cannot submit op. Document has not been created. "+this.collection+"."+this.id);return i?i(o):this.emit("error",o)}this.type.normalize&&(t.op=this.type.normalize(t.op))}this._pushOp(t,i),this._otApply(t,n);var s=this;e.nextTick(function(){s.flush()})},s.prototype._pushOp=function(t,e){if(this.applyStack)this.applyStack.push(t);else{var n=this._tryCompose(t);if(n)return void n.callbacks.push(e)}t.type=this.type,t.callbacks=[e],this.pendingOps.push(t)},s.prototype._popApplyStack=function(t){if(t>0)this.applyStack.length=t;else{var e=this.applyStack[0];if(this.applyStack=null,e)if(-1!==(i=this.pendingOps.indexOf(e)))for(var n=this.pendingOps.splice(i),i=0;i<n.length;i++){e=n[i];var r=this._tryCompose(e);r?r.callbacks=r.callbacks.concat(e.callbacks):this.pendingOps.push(e)}}},s.prototype._tryCompose=function(t){if(!this.preventCompose){var e=this.pendingOps[this.pendingOps.length-1];if(e)return e.create&&t.op?(e.create.data=this.type.apply(e.create.data,t.op),e):e.op&&t.op&&this.type.compose?(e.op=this.type.compose(e.op,t.op),e):void 0}},s.prototype.submitOp=function(t,e,n){"function"==typeof e&&(n=e,e=null);var i={op:t},r=e&&e.source;this._submit(i,r,n)},s.prototype.create=function(t,e,n,i){if("function"==typeof e?(i=e,n=null,e=null):"function"==typeof n&&(i=n,n=null),e||(e=o.defaultType.uri),this.type){var s=new r(4016,"Document already exists");return i?i(s):this.emit("error",s)}var a={create:{type:e,data:t}},u=n&&n.source;this._submit(a,u,i)},s.prototype.del=function(t,e){if("function"==typeof t&&(e=t,t=null),!this.type){var n=new r(4015,"Document does not exist");return e?e(n):this.emit("error",n)}var i=t&&t.source;this._submit({del:!0},i,e)},s.prototype.pause=function(){this.paused=!0},s.prototype.resume=function(){this.paused=!1,this.flush()},s.prototype._opAcknowledged=function(t){if(this.inflightOp.create)this.version=t.v;else if(t.v!==this.version)return console.warn("Invalid version from server. Expected: "+this.version+" Received: "+t.v,t),this.fetch();this.version++,this._clearInflightOp()},s.prototype._rollback=function(t){var e=this.inflightOp;if(e.op&&e.type.invert){e.op=e.type.invert(e.op);for(var n=0;n<this.pendingOps.length;n++){var i=u(this.pendingOps[n],e);if(i)return this._hardRollback(i)}return this._otApply(e,!1),void this._clearInflightOp(t)}this._hardRollback(t)},s.prototype._hardRollback=function(t){var e=this.inflightOp,n=this.pendingOps;this._setType(null),this.version=null,this.inflightOp=null,this.pendingOps=[];var i=this;this.fetch(function(){for(var r=e&&c(e.callbacks,t),o=0;o<n.length;o++)c(n[o].callbacks,t);if(t&&!r)return i.emit("error",t)})},s.prototype._clearInflightOp=function(t){var e=c(this.inflightOp.callbacks,t);if(this.inflightOp=null,this.flush(),this._emitNothingPending(),t&&!e)return this.emit("error",t)}}).call(this,n(0))},function(t,e,n){(function(e){var i=n(5);function r(t,e,n,r,o,s,a){i.EventEmitter.call(this),this.action=t,this.connection=e,this.id=n,this.collection=r,this.query=o,this.results=null,s&&s.results&&(this.results=s.results,delete s.results),this.extra=void 0,this.options=s,this.callback=a,this.ready=!1,this.sent=!1}t.exports=r,i.mixin(r),r.prototype.hasPending=function(){return!this.ready},r.prototype.send=function(){if(this.connection.canSend){var t={a:this.action,id:this.id,c:this.collection,q:this.query};if(this.options&&(t.o=this.options),this.results){for(var e=[],n=0;n<this.results.length;n++){var i=this.results[n];e.push([i.id,i.version])}t.r=e}this.connection.send(t),this.sent=!0}},r.prototype.destroy=function(t){this.connection.canSend&&"qs"===this.action&&this.connection.send({a:"qu",id:this.id}),this.connection._destroyQuery(this),t&&e.nextTick(t)},r.prototype._onConnectionStateChanged=function(){this.connection.canSend&&!this.sent?this.send():this.sent=!1},r.prototype._handleFetch=function(t,e,n){this.connection._destroyQuery(this),this._handleResponse(t,e,n)},r.prototype._handleSubscribe=function(t,e,n){this._handleResponse(t,e,n)},r.prototype._handleResponse=function(t,e,n){var i=this.callback;if(this.callback=null,t)return this._finishResponse(t,i);if(!e)return this._finishResponse(null,i);var r=this,o=1,s=function(t){if(t)return r._finishResponse(t,i);--o||r._finishResponse(null,i)};if(Array.isArray(e))o+=e.length,this.results=this._ingestSnapshots(e,s),this.extra=n;else for(var a in e){o++;var u=e[a];this.connection.get(u.c||this.collection,a).ingestSnapshot(u,s)}s()},r.prototype._ingestSnapshots=function(t,e){for(var n=[],i=0;i<t.length;i++){var r=t[i],o=this.connection.get(r.c||this.collection,r.d);o.ingestSnapshot(r,e),n.push(o)}return n},r.prototype._finishResponse=function(t,e){if(this.emit("ready"),this.ready=!0,t)return this.connection._destroyQuery(this),e?e(t):this.emit("error",t);e&&e(null,this.results,this.extra)},r.prototype._handleError=function(t){this.emit("error",t)},r.prototype._handleDiff=function(t){for(var e=0;e<t.length;e++){"insert"===(n=t[e]).type&&(n.values=this._ingestSnapshots(n.values))}for(e=0;e<t.length;e++){var n;switch((n=t[e]).type){case"insert":var i=n.values;Array.prototype.splice.apply(this.results,[n.index,0].concat(i)),this.emit("insert",i,n.index);break;case"remove":var r=n.howMany||1,o=this.results.splice(n.index,r);this.emit("remove",o,n.index);break;case"move":r=n.howMany||1;var s=this.results.splice(n.from,r);Array.prototype.splice.apply(this.results,[n.to,0].concat(s)),this.emit("move",s,n.from,n.to)}}this.emit("changed",this.results)},r.prototype._handleExtra=function(t){this.extra=t,this.emit("extra",t)}}).call(this,n(0))},function(t,e,n){(function(e){var i=n(31),r=n(14);function o(t){if(!(this instanceof o))return new o(t);i.call(this,t),this.docs={},this.ops={},this.closed=!1}function s(t){return void 0===t?void 0:JSON.parse(JSON.stringify(t))}t.exports=o,o.prototype=Object.create(i.prototype),o.prototype.close=function(t){this.closed=!0,t&&t()},o.prototype.commit=function(t,n,i,r,o,s){var a=this;if("function"!=typeof s)throw new Error("Callback required");e.nextTick(function(){var e=a._getVersionSync(t,n);if(r.v!==e+1)return s(null,!1);var o=a._writeOpSync(t,n,i);return o?s(o):(o=a._writeSnapshotSync(t,n,r))?s(o):void s(null,!0)})},o.prototype.getSnapshot=function(t,n,i,r,o){var s=i&&i.$submit||r&&r.metadata,a=this;if("function"!=typeof o)throw new Error("Callback required");e.nextTick(function(){var e=a._getSnapshotSync(t,n,s);o(null,e)})},o.prototype.getOps=function(t,n,i,r,o,a){var u=o&&o.metadata,c=this;if("function"!=typeof a)throw new Error("Callback required");e.nextTick(function(){var e=c._getOpLogSync(t,n);null==r&&(r=e.length);var o=s(e.slice(i,r));if(!u)for(var l=0;l<o.length;l++)delete o[l].m;a(null,o)})},o.prototype.query=function(t,n,i,r,o){var s=r&&r.metadata,a=this;if("function"!=typeof o)throw new Error("Callback required");e.nextTick(function(){var e=a.docs[t],i=[];for(var u in e||{}){var c=a._getSnapshotSync(t,u,s);i.push(c)}try{var l=a._querySync(i,n,r);o(null,l.snapshots,l.extra)}catch(t){o(t)}})},o.prototype._querySync=function(t,e,n){return{snapshots:t}},o.prototype._writeOpSync=function(t,e,n){this._getOpLogSync(t,e)[n.v]=s(n)},o.prototype._writeSnapshotSync=function(t,e,n){var i=this.docs[t]||(this.docs[t]={});n.type?i[e]=s(n):delete i[e]},o.prototype._getSnapshotSync=function(t,e,n){var i,o=this.docs[t],a=o&&o[e];if(a){var u=s(a.data),c=n?s(a.m):null;i=new r(e,a.v,a.type,u,c)}else{var l=this._getVersionSync(t,e);i=new r(e,l,null,void 0,null)}return i},o.prototype._getOpLogSync=function(t,e){var n=this.ops[t]||(this.ops[t]={});return n[e]||(n[e]=[])},o.prototype._getVersionSync=function(t,e){var n=this.ops[t];return n&&n[e]&&n[e].length||0}}).call(this,n(0))},function(t,e,n){var i=n(22),r=n(1);function o(t){this.pollDebounce=t&&t.pollDebounce}t.exports=o,o.prototype.projectsSnapshots=!1,o.prototype.disableSubscribe=!1,o.prototype.close=function(t){t&&t()},o.prototype.commit=function(t,e,n,i,o,s){s(new r(5011,"commit DB method unimplemented"))},o.prototype.getSnapshot=function(t,e,n,i,o){o(new r(5012,"getSnapshot DB method unimplemented"))},o.prototype.getSnapshotBulk=function(t,e,n,r,o){var s={},a=this;i.each(e,function(e,i){a.getSnapshot(t,e,n,r,function(t,n){if(t)return i(t);s[e]=n,i()})},function(t){if(t)return o(t);o(null,s)})},o.prototype.getOps=function(t,e,n,i,o,s){s(new r(5013,"getOps DB method unimplemented"))},o.prototype.getOpsToSnapshot=function(t,e,n,i,r,o){var s=i.v;this.getOps(t,e,n,s,r,o)},o.prototype.getOpsBulk=function(t,e,n,r,o){var s={},a=this;i.forEachOf(e,function(e,i,o){var u=n&&n[i];a.getOps(t,i,e,u,r,function(t,e){if(t)return o(t);s[i]=e,o()})},function(t){if(t)return o(t);o(null,s)})},o.prototype.getCommittedOpVersion=function(t,e,n,i,r,o){this.getOpsToSnapshot(t,e,0,n,r,function(t,e){if(t)return o(t);for(var n=e.length;n--;){var r=e[n];if(i.src===r.src&&i.seq===r.seq)return o(null,r.v)}o()})},o.prototype.query=function(t,e,n,i,o){o(new r(4022,"query DB method unimplemented"))},o.prototype.queryPoll=function(t,e,n,i){this.query(t,e,{},n,function(t,e,n){if(t)return i(t);for(var r=[],o=0;o<e.length;o++)r.push(e[o].id);i(null,r,n)})},o.prototype.queryPollDoc=function(t,e,n,i,o){o(new r(5014,"queryPollDoc DB method unimplemented"))},o.prototype.canPollDoc=function(){return!1},o.prototype.skipPoll=function(){return!1}},function(t,e,n){(function(e){var i=n(33);function r(t){if(!(this instanceof r))return new r(t);i.call(this,t)}t.exports=r,r.prototype=Object.create(i.prototype),r.prototype._subscribe=function(t,n){n&&e.nextTick(n)},r.prototype._unsubscribe=function(t,n){n&&e.nextTick(n)},r.prototype._publish=function(t,n,i){var r=this;e.nextTick(function(){for(var e=0;e<t.length;e++){var o=t[e];r.subscribed[o]&&r._emit(o,n)}i&&i()})}}).call(this,n(0))},function(t,e,n){(function(e){var i=n(5),r=n(58),o=n(1),s=n(3);function a(t){if(!(this instanceof a))return new a(t);i.EventEmitter.call(this),this.prefix=t&&t.prefix,this.nextStreamId=1,this.streamsCount=0,this.streams={},this.subscribed={};var e=this;this._defaultCallback=function(t){if(t)return e.emit("error",t)}}function u(t){var e={};for(var n in t)e[n]=t[n];return e}t.exports=a,i.mixin(a),a.prototype.close=function(t){for(var n in this.streams){var i=this.streams[n];for(var r in i)i[r].destroy()}t&&e.nextTick(t)},a.prototype._subscribe=function(t,n){e.nextTick(function(){n(new o(5015,"_subscribe PubSub method unimplemented"))})},a.prototype._unsubscribe=function(t,n){e.nextTick(function(){n(new o(5016,"_unsubscribe PubSub method unimplemented"))})},a.prototype._publish=function(t,n,i){e.nextTick(function(){i(new o(5017,"_publish PubSub method unimplemented"))})},a.prototype.subscribe=function(t,n){n||(n=this._defaultCallback),this.prefix&&(t=this.prefix+" "+t);var i=this;this.subscribed[t]?e.nextTick(function(){var e=i._createStream(t);n(null,e)}):this._subscribe(t,function(e){if(e)return n(e);i.subscribed[t]=!0;var r=i._createStream(t);n(null,r)})},a.prototype.publish=function(t,e,n){if(n||(n=this._defaultCallback),this.prefix)for(var i=0;i<t.length;i++)t[i]=this.prefix+" "+t[i];this._publish(t,e,n)},a.prototype._emit=function(t,e){var n=this.streams[t];if(n)for(var i in n){var r=u(e);n[i].pushOp(r.c,r.d,r)}},a.prototype._createStream=function(t){var e=new r,n=this;e.once("close",function(){n._removeStream(t,e)}),this.streamsCount++;var i=this.streams[t]||(this.streams[t]={});return e.id=this.nextStreamId++,i[e.id]=e,e},a.prototype._removeStream=function(t,e){var n=this.streams[t];n&&(this.streamsCount--,delete n[e.id],s.hasKeys(n)||(delete this.streams[t],delete this.subscribed[t],this._unsubscribe(t,this._defaultCallback)))}}).call(this,n(0))},function(t,e,n){(function(t,i){var r=/%[sdj%]/g;e.format=function(t){if(!v(t)){for(var e=[],n=0;n<arguments.length;n++)e.push(a(arguments[n]));return e.join(" ")}n=1;for(var i=arguments,o=i.length,s=String(t).replace(r,function(t){if("%%"===t)return"%";if(n>=o)return t;switch(t){case"%s":return String(i[n++]);case"%d":return Number(i[n++]);case"%j":try{return JSON.stringify(i[n++])}catch(t){return"[Circular]"}default:return t}}),u=i[n];n<o;u=i[++n])y(u)||!w(u)?s+=" "+u:s+=" "+a(u);return s},e.deprecate=function(n,r){if(b(t.process))return function(){return e.deprecate(n,r).apply(this,arguments)};if(!0===i.noDeprecation)return n;var o=!1;return function(){if(!o){if(i.throwDeprecation)throw new Error(r);i.traceDeprecation?console.trace(r):console.error(r),o=!0}return n.apply(this,arguments)}};var o,s={};function a(t,n){var i={seen:[],stylize:c};return arguments.length>=3&&(i.depth=arguments[2]),arguments.length>=4&&(i.colors=arguments[3]),d(n)?i.showHidden=n:n&&e._extend(i,n),b(i.showHidden)&&(i.showHidden=!1),b(i.depth)&&(i.depth=2),b(i.colors)&&(i.colors=!1),b(i.customInspect)&&(i.customInspect=!0),i.colors&&(i.stylize=u),l(i,t,i.depth)}function u(t,e){var n=a.styles[e];return n?"["+a.colors[n][0]+"m"+t+"["+a.colors[n][1]+"m":t}function c(t,e){return t}function l(t,n,i){if(t.customInspect&&n&&k(n.inspect)&&n.inspect!==e.inspect&&(!n.constructor||n.constructor.prototype!==n)){var r=n.inspect(i,t);return v(r)||(r=l(t,r,i)),r}var o=function(t,e){if(b(e))return t.stylize("undefined","undefined");if(v(e)){var n="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(n,"string")}if(g(e))return t.stylize(""+e,"number");if(d(e))return t.stylize(""+e,"boolean");if(y(e))return t.stylize("null","null")}(t,n);if(o)return o;var s=Object.keys(n),a=function(t){var e={};return t.forEach(function(t,n){e[t]=!0}),e}(s);if(t.showHidden&&(s=Object.getOwnPropertyNames(n)),S(n)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return h(n);if(0===s.length){if(k(n)){var u=n.name?": "+n.name:"";return t.stylize("[Function"+u+"]","special")}if(m(n))return t.stylize(RegExp.prototype.toString.call(n),"regexp");if(_(n))return t.stylize(Date.prototype.toString.call(n),"date");if(S(n))return h(n)}var c,w="",O=!1,E=["{","}"];(p(n)&&(O=!0,E=["[","]"]),k(n))&&(w=" [Function"+(n.name?": "+n.name:"")+"]");return m(n)&&(w=" "+RegExp.prototype.toString.call(n)),_(n)&&(w=" "+Date.prototype.toUTCString.call(n)),S(n)&&(w=" "+h(n)),0!==s.length||O&&0!=n.length?i<0?m(n)?t.stylize(RegExp.prototype.toString.call(n),"regexp"):t.stylize("[Object]","special"):(t.seen.push(n),c=O?function(t,e,n,i,r){for(var o=[],s=0,a=e.length;s<a;++s)D(e,String(s))?o.push(f(t,e,n,i,String(s),!0)):o.push("");return r.forEach(function(r){r.match(/^\d+$/)||o.push(f(t,e,n,i,r,!0))}),o}(t,n,i,a,s):s.map(function(e){return f(t,n,i,a,e,O)}),t.seen.pop(),function(t,e,n){if(t.reduce(function(t,e){return 0,e.indexOf("\n")>=0&&0,t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return n[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+n[1];return n[0]+e+" "+t.join(", ")+" "+n[1]}(c,w,E)):E[0]+w+E[1]}function h(t){return"["+Error.prototype.toString.call(t)+"]"}function f(t,e,n,i,r,o){var s,a,u;if((u=Object.getOwnPropertyDescriptor(e,r)||{value:e[r]}).get?a=u.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):u.set&&(a=t.stylize("[Setter]","special")),D(i,r)||(s="["+r+"]"),a||(t.seen.indexOf(u.value)<0?(a=y(n)?l(t,u.value,null):l(t,u.value,n-1)).indexOf("\n")>-1&&(a=o?a.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+a.split("\n").map(function(t){return"   "+t}).join("\n")):a=t.stylize("[Circular]","special")),b(s)){if(o&&r.match(/^\d+$/))return a;(s=JSON.stringify(""+r)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=t.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=t.stylize(s,"string"))}return s+": "+a}function p(t){return Array.isArray(t)}function d(t){return"boolean"==typeof t}function y(t){return null===t}function g(t){return"number"==typeof t}function v(t){return"string"==typeof t}function b(t){return void 0===t}function m(t){return w(t)&&"[object RegExp]"===O(t)}function w(t){return"object"==typeof t&&null!==t}function _(t){return w(t)&&"[object Date]"===O(t)}function S(t){return w(t)&&("[object Error]"===O(t)||t instanceof Error)}function k(t){return"function"==typeof t}function O(t){return Object.prototype.toString.call(t)}function E(t){return t<10?"0"+t.toString(10):t.toString(10)}e.debuglog=function(t){if(b(o)&&(o=i.env.NODE_DEBUG||""),t=t.toUpperCase(),!s[t])if(new RegExp("\\b"+t+"\\b","i").test(o)){var n=i.pid;s[t]=function(){var i=e.format.apply(e,arguments);console.error("%s %d: %s",t,n,i)}}else s[t]=function(){};return s[t]},e.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e.isArray=p,e.isBoolean=d,e.isNull=y,e.isNullOrUndefined=function(t){return null==t},e.isNumber=g,e.isString=v,e.isSymbol=function(t){return"symbol"==typeof t},e.isUndefined=b,e.isRegExp=m,e.isObject=w,e.isDate=_,e.isError=S,e.isFunction=k,e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=n(59);var x=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function D(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.log=function(){console.log("%s - %s",function(){var t=new Date,e=[E(t.getHours()),E(t.getMinutes()),E(t.getSeconds())].join(":");return[t.getDate(),x[t.getMonth()],e].join(" ")}(),e.format.apply(e,arguments))},e.inherits=n(6),e._extend=function(t,e){if(!e||!w(e))return t;for(var n=Object.keys(e),i=n.length;i--;)t[n[i]]=e[n[i]];return t}}).call(this,n(2),n(0))},function(t,e,n){t.exports=r;var i=n(8).EventEmitter;function r(){i.call(this)}n(6)(r,i),r.Readable=n(16),r.Writable=n(67),r.Duplex=n(68),r.Transform=n(69),r.PassThrough=n(70),r.Stream=r,r.prototype.pipe=function(t,e){var n=this;function r(e){t.writable&&!1===t.write(e)&&n.pause&&n.pause()}function o(){n.readable&&n.resume&&n.resume()}n.on("data",r),t.on("drain",o),t._isStdio||e&&!1===e.end||(n.on("end",a),n.on("close",u));var s=!1;function a(){s||(s=!0,t.end())}function u(){s||(s=!0,"function"==typeof t.destroy&&t.destroy())}function c(t){if(l(),0===i.listenerCount(this,"error"))throw t}function l(){n.removeListener("data",r),t.removeListener("drain",o),n.removeListener("end",a),n.removeListener("close",u),n.removeListener("error",c),t.removeListener("error",c),n.removeListener("end",l),n.removeListener("close",l),t.removeListener("close",l)}return n.on("error",c),t.on("error",c),n.on("end",l),n.on("close",l),t.on("close",l),t.emit("pipe",n),t}},function(t,e,n){"use strict";(function(e,i){var r=n(11);t.exports=m;var o,s=n(37);m.ReadableState=b;n(8).EventEmitter;var a=function(t,e){return t.listeners(e).length},u=n(38),c=n(12).Buffer,l=e.Uint8Array||function(){};var h=n(9);h.inherits=n(6);var f=n(62),p=void 0;p=f&&f.debuglog?f.debuglog("stream"):function(){};var d,y=n(63),g=n(40);h.inherits(m,u);var v=["error","close","destroy","pause","resume"];function b(t,e){o=o||n(7),t=t||{};var i=e instanceof o;this.objectMode=!!t.objectMode,i&&(this.objectMode=this.objectMode||!!t.readableObjectMode);var r=t.highWaterMark,s=t.readableHighWaterMark,a=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:i&&(s||0===s)?s:a,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new y,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(d||(d=n(41).StringDecoder),this.decoder=new d(t.encoding),this.encoding=t.encoding)}function m(t){if(o=o||n(7),!(this instanceof m))return new m(t);this._readableState=new b(t,this),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),u.call(this)}function w(t,e,n,i,r){var o,s=t._readableState;null===e?(s.reading=!1,function(t,e){if(e.ended)return;if(e.decoder){var n=e.decoder.end();n&&n.length&&(e.buffer.push(n),e.length+=e.objectMode?1:n.length)}e.ended=!0,O(t)}(t,s)):(r||(o=function(t,e){var n;(function(t){return c.isBuffer(t)||t instanceof l})(e)||"string"==typeof e||void 0===e||t.objectMode||(n=new TypeError("Invalid non-string/buffer chunk"));return n}(s,e)),o?t.emit("error",o):s.objectMode||e&&e.length>0?("string"==typeof e||s.objectMode||Object.getPrototypeOf(e)===c.prototype||(e=function(t){return c.from(t)}(e)),i?s.endEmitted?t.emit("error",new Error("stream.unshift() after end event")):_(t,s,e,!0):s.ended?t.emit("error",new Error("stream.push() after EOF")):(s.reading=!1,s.decoder&&!n?(e=s.decoder.write(e),s.objectMode||0!==e.length?_(t,s,e,!1):x(t,s)):_(t,s,e,!1))):i||(s.reading=!1));return function(t){return!t.ended&&(t.needReadable||t.length<t.highWaterMark||0===t.length)}(s)}function _(t,e,n,i){e.flowing&&0===e.length&&!e.sync?(t.emit("data",n),t.read(0)):(e.length+=e.objectMode?1:n.length,i?e.buffer.unshift(n):e.buffer.push(n),e.needReadable&&O(t)),x(t,e)}Object.defineProperty(m.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(t){this._readableState&&(this._readableState.destroyed=t)}}),m.prototype.destroy=g.destroy,m.prototype._undestroy=g.undestroy,m.prototype._destroy=function(t,e){this.push(null),e(t)},m.prototype.push=function(t,e){var n,i=this._readableState;return i.objectMode?n=!0:"string"==typeof t&&((e=e||i.defaultEncoding)!==i.encoding&&(t=c.from(t,e),e=""),n=!0),w(this,t,e,!1,n)},m.prototype.unshift=function(t){return w(this,t,null,!0,!1)},m.prototype.isPaused=function(){return!1===this._readableState.flowing},m.prototype.setEncoding=function(t){return d||(d=n(41).StringDecoder),this._readableState.decoder=new d(t),this._readableState.encoding=t,this};var S=8388608;function k(t,e){return t<=0||0===e.length&&e.ended?0:e.objectMode?1:t!=t?e.flowing&&e.length?e.buffer.head.data.length:e.length:(t>e.highWaterMark&&(e.highWaterMark=function(t){return t>=S?t=S:(t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++),t}(t)),t<=e.length?t:e.ended?e.length:(e.needReadable=!0,0))}function O(t){var e=t._readableState;e.needReadable=!1,e.emittedReadable||(p("emitReadable",e.flowing),e.emittedReadable=!0,e.sync?r.nextTick(E,t):E(t))}function E(t){p("emit readable"),t.emit("readable"),A(t)}function x(t,e){e.readingMore||(e.readingMore=!0,r.nextTick(D,t,e))}function D(t,e){for(var n=e.length;!e.reading&&!e.flowing&&!e.ended&&e.length<e.highWaterMark&&(p("maybeReadMore read 0"),t.read(0),n!==e.length);)n=e.length;e.readingMore=!1}function T(t){p("readable nexttick read 0"),t.read(0)}function P(t,e){e.reading||(p("resume read 0"),t.read(0)),e.resumeScheduled=!1,e.awaitDrain=0,t.emit("resume"),A(t),e.flowing&&!e.reading&&t.read(0)}function A(t){var e=t._readableState;for(p("flow",e.flowing);e.flowing&&null!==t.read(););}function R(t,e){return 0===e.length?null:(e.objectMode?n=e.buffer.shift():!t||t>=e.length?(n=e.decoder?e.buffer.join(""):1===e.buffer.length?e.buffer.head.data:e.buffer.concat(e.length),e.buffer.clear()):n=function(t,e,n){var i;t<e.head.data.length?(i=e.head.data.slice(0,t),e.head.data=e.head.data.slice(t)):i=t===e.head.data.length?e.shift():n?function(t,e){var n=e.head,i=1,r=n.data;t-=r.length;for(;n=n.next;){var o=n.data,s=t>o.length?o.length:t;if(s===o.length?r+=o:r+=o.slice(0,t),0===(t-=s)){s===o.length?(++i,n.next?e.head=n.next:e.head=e.tail=null):(e.head=n,n.data=o.slice(s));break}++i}return e.length-=i,r}(t,e):function(t,e){var n=c.allocUnsafe(t),i=e.head,r=1;i.data.copy(n),t-=i.data.length;for(;i=i.next;){var o=i.data,s=t>o.length?o.length:t;if(o.copy(n,n.length-t,0,s),0===(t-=s)){s===o.length?(++r,i.next?e.head=i.next:e.head=e.tail=null):(e.head=i,i.data=o.slice(s));break}++r}return e.length-=r,n}(t,e);return i}(t,e.buffer,e.decoder),n);var n}function M(t){var e=t._readableState;if(e.length>0)throw new Error('"endReadable()" called on non-empty stream');e.endEmitted||(e.ended=!0,r.nextTick(j,e,t))}function j(t,e){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))}function I(t,e){for(var n=0,i=t.length;n<i;n++)if(t[n]===e)return n;return-1}m.prototype.read=function(t){p("read",t),t=parseInt(t,10);var e=this._readableState,n=t;if(0!==t&&(e.emittedReadable=!1),0===t&&e.needReadable&&(e.length>=e.highWaterMark||e.ended))return p("read: emitReadable",e.length,e.ended),0===e.length&&e.ended?M(this):O(this),null;if(0===(t=k(t,e))&&e.ended)return 0===e.length&&M(this),null;var i,r=e.needReadable;return p("need readable",r),(0===e.length||e.length-t<e.highWaterMark)&&p("length less than watermark",r=!0),e.ended||e.reading?p("reading or ended",r=!1):r&&(p("do read"),e.reading=!0,e.sync=!0,0===e.length&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,e.reading||(t=k(n,e))),null===(i=t>0?R(t,e):null)?(e.needReadable=!0,t=0):e.length-=t,0===e.length&&(e.ended||(e.needReadable=!0),n!==t&&e.ended&&M(this)),null!==i&&this.emit("data",i),i},m.prototype._read=function(t){this.emit("error",new Error("_read() is not implemented"))},m.prototype.pipe=function(t,e){var n=this,o=this._readableState;switch(o.pipesCount){case 0:o.pipes=t;break;case 1:o.pipes=[o.pipes,t];break;default:o.pipes.push(t)}o.pipesCount+=1,p("pipe count=%d opts=%j",o.pipesCount,e);var u=(!e||!1!==e.end)&&t!==i.stdout&&t!==i.stderr?l:m;function c(e,i){p("onunpipe"),e===n&&i&&!1===i.hasUnpiped&&(i.hasUnpiped=!0,p("cleanup"),t.removeListener("close",v),t.removeListener("finish",b),t.removeListener("drain",h),t.removeListener("error",g),t.removeListener("unpipe",c),n.removeListener("end",l),n.removeListener("end",m),n.removeListener("data",y),f=!0,!o.awaitDrain||t._writableState&&!t._writableState.needDrain||h())}function l(){p("onend"),t.end()}o.endEmitted?r.nextTick(u):n.once("end",u),t.on("unpipe",c);var h=function(t){return function(){var e=t._readableState;p("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&a(t,"data")&&(e.flowing=!0,A(t))}}(n);t.on("drain",h);var f=!1;var d=!1;function y(e){p("ondata"),d=!1,!1!==t.write(e)||d||((1===o.pipesCount&&o.pipes===t||o.pipesCount>1&&-1!==I(o.pipes,t))&&!f&&(p("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,d=!0),n.pause())}function g(e){p("onerror",e),m(),t.removeListener("error",g),0===a(t,"error")&&t.emit("error",e)}function v(){t.removeListener("finish",b),m()}function b(){p("onfinish"),t.removeListener("close",v),m()}function m(){p("unpipe"),n.unpipe(t)}return n.on("data",y),function(t,e,n){if("function"==typeof t.prependListener)return t.prependListener(e,n);t._events&&t._events[e]?s(t._events[e])?t._events[e].unshift(n):t._events[e]=[n,t._events[e]]:t.on(e,n)}(t,"error",g),t.once("close",v),t.once("finish",b),t.emit("pipe",n),o.flowing||(p("pipe resume"),n.resume()),t},m.prototype.unpipe=function(t){var e=this._readableState,n={hasUnpiped:!1};if(0===e.pipesCount)return this;if(1===e.pipesCount)return t&&t!==e.pipes?this:(t||(t=e.pipes),e.pipes=null,e.pipesCount=0,e.flowing=!1,t&&t.emit("unpipe",this,n),this);if(!t){var i=e.pipes,r=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var o=0;o<r;o++)i[o].emit("unpipe",this,n);return this}var s=I(e.pipes,t);return-1===s?this:(e.pipes.splice(s,1),e.pipesCount-=1,1===e.pipesCount&&(e.pipes=e.pipes[0]),t.emit("unpipe",this,n),this)},m.prototype.on=function(t,e){var n=u.prototype.on.call(this,t,e);if("data"===t)!1!==this._readableState.flowing&&this.resume();else if("readable"===t){var i=this._readableState;i.endEmitted||i.readableListening||(i.readableListening=i.needReadable=!0,i.emittedReadable=!1,i.reading?i.length&&O(this):r.nextTick(T,this))}return n},m.prototype.addListener=m.prototype.on,m.prototype.resume=function(){var t=this._readableState;return t.flowing||(p("resume"),t.flowing=!0,function(t,e){e.resumeScheduled||(e.resumeScheduled=!0,r.nextTick(P,t,e))}(this,t)),this},m.prototype.pause=function(){return p("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(p("pause"),this._readableState.flowing=!1,this.emit("pause")),this},m.prototype.wrap=function(t){var e=this,n=this._readableState,i=!1;for(var r in t.on("end",function(){if(p("wrapped end"),n.decoder&&!n.ended){var t=n.decoder.end();t&&t.length&&e.push(t)}e.push(null)}),t.on("data",function(r){(p("wrapped data"),n.decoder&&(r=n.decoder.write(r)),!n.objectMode||null!==r&&void 0!==r)&&((n.objectMode||r&&r.length)&&(e.push(r)||(i=!0,t.pause())))}),t)void 0===this[r]&&"function"==typeof t[r]&&(this[r]=function(e){return function(){return t[e].apply(t,arguments)}}(r));for(var o=0;o<v.length;o++)t.on(v[o],this.emit.bind(this,v[o]));return this._read=function(e){p("wrapped _read",e),i&&(i=!1,t.resume())},this},Object.defineProperty(m.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),m._fromList=R}).call(this,n(2),n(0))},function(t,e){var n={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==n.call(t)}},function(t,e,n){t.exports=n(8).EventEmitter},function(t,e,n){"use strict";(function(t){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var i=n(60),r=n(61),o=n(37);function s(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(t,e){if(s()<e)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=u.prototype:(null===t&&(t=new u(e)),t.length=e),t}function u(t,e,n){if(!(u.TYPED_ARRAY_SUPPORT||this instanceof u))return new u(t,e,n);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return h(this,t)}return c(this,t,e,n)}function c(t,e,n,i){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,n,i){if(e.byteLength,n<0||e.byteLength<n)throw new RangeError("'offset' is out of bounds");if(e.byteLength<n+(i||0))throw new RangeError("'length' is out of bounds");e=void 0===n&&void 0===i?new Uint8Array(e):void 0===i?new Uint8Array(e,n):new Uint8Array(e,n,i);u.TYPED_ARRAY_SUPPORT?(t=e).__proto__=u.prototype:t=f(t,e);return t}(t,e,n,i):"string"==typeof e?function(t,e,n){"string"==typeof n&&""!==n||(n="utf8");if(!u.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var i=0|d(e,n),r=(t=a(t,i)).write(e,n);r!==i&&(t=t.slice(0,r));return t}(t,e,n):function(t,e){if(u.isBuffer(e)){var n=0|p(e.length);return 0===(t=a(t,n)).length?t:(e.copy(t,0,0,n),t)}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||function(t){return t!=t}(e.length)?a(t,0):f(t,e);if("Buffer"===e.type&&o(e.data))return f(t,e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function l(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function h(t,e){if(l(e),t=a(t,e<0?0:0|p(e)),!u.TYPED_ARRAY_SUPPORT)for(var n=0;n<e;++n)t[n]=0;return t}function f(t,e){var n=e.length<0?0:0|p(e.length);t=a(t,n);for(var i=0;i<n;i+=1)t[i]=255&e[i];return t}function p(t){if(t>=s())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s().toString(16)+" bytes");return 0|t}function d(t,e){if(u.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var i=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return U(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return F(t).length;default:if(i)return U(t).length;e=(""+e).toLowerCase(),i=!0}}function y(t,e,n){var i=t[e];t[e]=t[n],t[n]=i}function g(t,e,n,i,r){if(0===t.length)return-1;if("string"==typeof n?(i=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=r?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(r)return-1;n=t.length-1}else if(n<0){if(!r)return-1;n=0}if("string"==typeof e&&(e=u.from(e,i)),u.isBuffer(e))return 0===e.length?-1:v(t,e,n,i,r);if("number"==typeof e)return e&=255,u.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):v(t,[e],n,i,r);throw new TypeError("val must be string, number or Buffer")}function v(t,e,n,i,r){var o,s=1,a=t.length,u=e.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(t.length<2||e.length<2)return-1;s=2,a/=2,u/=2,n/=2}function c(t,e){return 1===s?t[e]:t.readUInt16BE(e*s)}if(r){var l=-1;for(o=n;o<a;o++)if(c(t,o)===c(e,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===u)return l*s}else-1!==l&&(o-=o-l),l=-1}else for(n+u>a&&(n=a-u),o=n;o>=0;o--){for(var h=!0,f=0;f<u;f++)if(c(t,o+f)!==c(e,f)){h=!1;break}if(h)return o}return-1}function b(t,e,n,i){n=Number(n)||0;var r=t.length-n;i?(i=Number(i))>r&&(i=r):i=r;var o=e.length;if(o%2!=0)throw new TypeError("Invalid hex string");i>o/2&&(i=o/2);for(var s=0;s<i;++s){var a=parseInt(e.substr(2*s,2),16);if(isNaN(a))return s;t[n+s]=a}return s}function m(t,e,n,i){return z(U(e,t.length-n),t,n,i)}function w(t,e,n,i){return z(function(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}(e),t,n,i)}function _(t,e,n,i){return w(t,e,n,i)}function S(t,e,n,i){return z(F(e),t,n,i)}function k(t,e,n,i){return z(function(t,e){for(var n,i,r,o=[],s=0;s<t.length&&!((e-=2)<0);++s)n=t.charCodeAt(s),i=n>>8,r=n%256,o.push(r),o.push(i);return o}(e,t.length-n),t,n,i)}function O(t,e,n){return 0===e&&n===t.length?i.fromByteArray(t):i.fromByteArray(t.slice(e,n))}function E(t,e,n){n=Math.min(t.length,n);for(var i=[],r=e;r<n;){var o,s,a,u,c=t[r],l=null,h=c>239?4:c>223?3:c>191?2:1;if(r+h<=n)switch(h){case 1:c<128&&(l=c);break;case 2:128==(192&(o=t[r+1]))&&(u=(31&c)<<6|63&o)>127&&(l=u);break;case 3:o=t[r+1],s=t[r+2],128==(192&o)&&128==(192&s)&&(u=(15&c)<<12|(63&o)<<6|63&s)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:o=t[r+1],s=t[r+2],a=t[r+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(u=(15&c)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&u<1114112&&(l=u)}null===l?(l=65533,h=1):l>65535&&(l-=65536,i.push(l>>>10&1023|55296),l=56320|1023&l),i.push(l),r+=h}return function(t){var e=t.length;if(e<=x)return String.fromCharCode.apply(String,t);var n="",i=0;for(;i<e;)n+=String.fromCharCode.apply(String,t.slice(i,i+=x));return n}(i)}e.Buffer=u,e.SlowBuffer=function(t){+t!=t&&(t=0);return u.alloc(+t)},e.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),e.kMaxLength=s(),u.poolSize=8192,u._augment=function(t){return t.__proto__=u.prototype,t},u.from=function(t,e,n){return c(null,t,e,n)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(t,e,n){return function(t,e,n,i){return l(e),e<=0?a(t,e):void 0!==n?"string"==typeof i?a(t,e).fill(n,i):a(t,e).fill(n):a(t,e)}(null,t,e,n)},u.allocUnsafe=function(t){return h(null,t)},u.allocUnsafeSlow=function(t){return h(null,t)},u.isBuffer=function(t){return!(null==t||!t._isBuffer)},u.compare=function(t,e){if(!u.isBuffer(t)||!u.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var n=t.length,i=e.length,r=0,o=Math.min(n,i);r<o;++r)if(t[r]!==e[r]){n=t[r],i=e[r];break}return n<i?-1:i<n?1:0},u.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(t,e){if(!o(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return u.alloc(0);var n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;var i=u.allocUnsafe(e),r=0;for(n=0;n<t.length;++n){var s=t[n];if(!u.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(i,r),r+=s.length}return i},u.byteLength=d,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)y(this,e,e+1);return this},u.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)y(this,e,e+3),y(this,e+1,e+2);return this},u.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)y(this,e,e+7),y(this,e+1,e+6),y(this,e+2,e+5),y(this,e+3,e+4);return this},u.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?E(this,0,t):function(t,e,n){var i=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return P(this,e,n);case"utf8":case"utf-8":return E(this,e,n);case"ascii":return D(this,e,n);case"latin1":case"binary":return T(this,e,n);case"base64":return O(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,e,n);default:if(i)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),i=!0}}.apply(this,arguments)},u.prototype.equals=function(t){if(!u.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===u.compare(this,t)},u.prototype.inspect=function(){var t="",n=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(t+=" ... ")),"<Buffer "+t+">"},u.prototype.compare=function(t,e,n,i,r){if(!u.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===i&&(i=0),void 0===r&&(r=this.length),e<0||n>t.length||i<0||r>this.length)throw new RangeError("out of range index");if(i>=r&&e>=n)return 0;if(i>=r)return-1;if(e>=n)return 1;if(e>>>=0,n>>>=0,i>>>=0,r>>>=0,this===t)return 0;for(var o=r-i,s=n-e,a=Math.min(o,s),c=this.slice(i,r),l=t.slice(e,n),h=0;h<a;++h)if(c[h]!==l[h]){o=c[h],s=l[h];break}return o<s?-1:s<o?1:0},u.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},u.prototype.indexOf=function(t,e,n){return g(this,t,e,n,!0)},u.prototype.lastIndexOf=function(t,e,n){return g(this,t,e,n,!1)},u.prototype.write=function(t,e,n,i){if(void 0===e)i="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)i=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(n)?(n|=0,void 0===i&&(i="utf8")):(i=n,n=void 0)}var r=this.length-e;if((void 0===n||n>r)&&(n=r),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var o=!1;;)switch(i){case"hex":return b(this,t,e,n);case"utf8":case"utf-8":return m(this,t,e,n);case"ascii":return w(this,t,e,n);case"latin1":case"binary":return _(this,t,e,n);case"base64":return S(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,t,e,n);default:if(o)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),o=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var x=4096;function D(t,e,n){var i="";n=Math.min(t.length,n);for(var r=e;r<n;++r)i+=String.fromCharCode(127&t[r]);return i}function T(t,e,n){var i="";n=Math.min(t.length,n);for(var r=e;r<n;++r)i+=String.fromCharCode(t[r]);return i}function P(t,e,n){var i=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>i)&&(n=i);for(var r="",o=e;o<n;++o)r+=N(t[o]);return r}function A(t,e,n){for(var i=t.slice(e,n),r="",o=0;o<i.length;o+=2)r+=String.fromCharCode(i[o]+256*i[o+1]);return r}function R(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function M(t,e,n,i,r,o){if(!u.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>r||e<o)throw new RangeError('"value" argument is out of bounds');if(n+i>t.length)throw new RangeError("Index out of range")}function j(t,e,n,i){e<0&&(e=65535+e+1);for(var r=0,o=Math.min(t.length-n,2);r<o;++r)t[n+r]=(e&255<<8*(i?r:1-r))>>>8*(i?r:1-r)}function I(t,e,n,i){e<0&&(e=4294967295+e+1);for(var r=0,o=Math.min(t.length-n,4);r<o;++r)t[n+r]=e>>>8*(i?r:3-r)&255}function C(t,e,n,i,r,o){if(n+i>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function q(t,e,n,i,o){return o||C(t,0,n,4),r.write(t,e,n,i,23,4),n+4}function B(t,e,n,i,o){return o||C(t,0,n,8),r.write(t,e,n,i,52,8),n+8}u.prototype.slice=function(t,e){var n,i=this.length;if(t=~~t,e=void 0===e?i:~~e,t<0?(t+=i)<0&&(t=0):t>i&&(t=i),e<0?(e+=i)<0&&(e=0):e>i&&(e=i),e<t&&(e=t),u.TYPED_ARRAY_SUPPORT)(n=this.subarray(t,e)).__proto__=u.prototype;else{var r=e-t;n=new u(r,void 0);for(var o=0;o<r;++o)n[o]=this[o+t]}return n},u.prototype.readUIntLE=function(t,e,n){t|=0,e|=0,n||R(t,e,this.length);for(var i=this[t],r=1,o=0;++o<e&&(r*=256);)i+=this[t+o]*r;return i},u.prototype.readUIntBE=function(t,e,n){t|=0,e|=0,n||R(t,e,this.length);for(var i=this[t+--e],r=1;e>0&&(r*=256);)i+=this[t+--e]*r;return i},u.prototype.readUInt8=function(t,e){return e||R(t,1,this.length),this[t]},u.prototype.readUInt16LE=function(t,e){return e||R(t,2,this.length),this[t]|this[t+1]<<8},u.prototype.readUInt16BE=function(t,e){return e||R(t,2,this.length),this[t]<<8|this[t+1]},u.prototype.readUInt32LE=function(t,e){return e||R(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},u.prototype.readUInt32BE=function(t,e){return e||R(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},u.prototype.readIntLE=function(t,e,n){t|=0,e|=0,n||R(t,e,this.length);for(var i=this[t],r=1,o=0;++o<e&&(r*=256);)i+=this[t+o]*r;return i>=(r*=128)&&(i-=Math.pow(2,8*e)),i},u.prototype.readIntBE=function(t,e,n){t|=0,e|=0,n||R(t,e,this.length);for(var i=e,r=1,o=this[t+--i];i>0&&(r*=256);)o+=this[t+--i]*r;return o>=(r*=128)&&(o-=Math.pow(2,8*e)),o},u.prototype.readInt8=function(t,e){return e||R(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},u.prototype.readInt16LE=function(t,e){e||R(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt16BE=function(t,e){e||R(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt32LE=function(t,e){return e||R(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},u.prototype.readInt32BE=function(t,e){return e||R(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},u.prototype.readFloatLE=function(t,e){return e||R(t,4,this.length),r.read(this,t,!0,23,4)},u.prototype.readFloatBE=function(t,e){return e||R(t,4,this.length),r.read(this,t,!1,23,4)},u.prototype.readDoubleLE=function(t,e){return e||R(t,8,this.length),r.read(this,t,!0,52,8)},u.prototype.readDoubleBE=function(t,e){return e||R(t,8,this.length),r.read(this,t,!1,52,8)},u.prototype.writeUIntLE=function(t,e,n,i){(t=+t,e|=0,n|=0,i)||M(this,t,e,n,Math.pow(2,8*n)-1,0);var r=1,o=0;for(this[e]=255&t;++o<n&&(r*=256);)this[e+o]=t/r&255;return e+n},u.prototype.writeUIntBE=function(t,e,n,i){(t=+t,e|=0,n|=0,i)||M(this,t,e,n,Math.pow(2,8*n)-1,0);var r=n-1,o=1;for(this[e+r]=255&t;--r>=0&&(o*=256);)this[e+r]=t/o&255;return e+n},u.prototype.writeUInt8=function(t,e,n){return t=+t,e|=0,n||M(this,t,e,1,255,0),u.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},u.prototype.writeUInt16LE=function(t,e,n){return t=+t,e|=0,n||M(this,t,e,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):j(this,t,e,!0),e+2},u.prototype.writeUInt16BE=function(t,e,n){return t=+t,e|=0,n||M(this,t,e,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):j(this,t,e,!1),e+2},u.prototype.writeUInt32LE=function(t,e,n){return t=+t,e|=0,n||M(this,t,e,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):I(this,t,e,!0),e+4},u.prototype.writeUInt32BE=function(t,e,n){return t=+t,e|=0,n||M(this,t,e,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):I(this,t,e,!1),e+4},u.prototype.writeIntLE=function(t,e,n,i){if(t=+t,e|=0,!i){var r=Math.pow(2,8*n-1);M(this,t,e,n,r-1,-r)}var o=0,s=1,a=0;for(this[e]=255&t;++o<n&&(s*=256);)t<0&&0===a&&0!==this[e+o-1]&&(a=1),this[e+o]=(t/s>>0)-a&255;return e+n},u.prototype.writeIntBE=function(t,e,n,i){if(t=+t,e|=0,!i){var r=Math.pow(2,8*n-1);M(this,t,e,n,r-1,-r)}var o=n-1,s=1,a=0;for(this[e+o]=255&t;--o>=0&&(s*=256);)t<0&&0===a&&0!==this[e+o+1]&&(a=1),this[e+o]=(t/s>>0)-a&255;return e+n},u.prototype.writeInt8=function(t,e,n){return t=+t,e|=0,n||M(this,t,e,1,127,-128),u.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},u.prototype.writeInt16LE=function(t,e,n){return t=+t,e|=0,n||M(this,t,e,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):j(this,t,e,!0),e+2},u.prototype.writeInt16BE=function(t,e,n){return t=+t,e|=0,n||M(this,t,e,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):j(this,t,e,!1),e+2},u.prototype.writeInt32LE=function(t,e,n){return t=+t,e|=0,n||M(this,t,e,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):I(this,t,e,!0),e+4},u.prototype.writeInt32BE=function(t,e,n){return t=+t,e|=0,n||M(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):I(this,t,e,!1),e+4},u.prototype.writeFloatLE=function(t,e,n){return q(this,t,e,!0,n)},u.prototype.writeFloatBE=function(t,e,n){return q(this,t,e,!1,n)},u.prototype.writeDoubleLE=function(t,e,n){return B(this,t,e,!0,n)},u.prototype.writeDoubleBE=function(t,e,n){return B(this,t,e,!1,n)},u.prototype.copy=function(t,e,n,i){if(n||(n=0),i||0===i||(i=this.length),e>=t.length&&(e=t.length),e||(e=0),i>0&&i<n&&(i=n),i===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),t.length-e<i-n&&(i=t.length-e+n);var r,o=i-n;if(this===t&&n<e&&e<i)for(r=o-1;r>=0;--r)t[r+e]=this[r+n];else if(o<1e3||!u.TYPED_ARRAY_SUPPORT)for(r=0;r<o;++r)t[r+e]=this[r+n];else Uint8Array.prototype.set.call(t,this.subarray(n,n+o),e);return o},u.prototype.fill=function(t,e,n,i){if("string"==typeof t){if("string"==typeof e?(i=e,e=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),1===t.length){var r=t.charCodeAt(0);r<256&&(t=r)}if(void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!u.isEncoding(i))throw new TypeError("Unknown encoding: "+i)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;var o;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(o=e;o<n;++o)this[o]=t;else{var s=u.isBuffer(t)?t:U(new u(t,i).toString()),a=s.length;for(o=0;o<n-e;++o)this[o+e]=s[o%a]}return this};var L=/[^+\/0-9A-Za-z-_]/g;function N(t){return t<16?"0"+t.toString(16):t.toString(16)}function U(t,e){var n;e=e||1/0;for(var i=t.length,r=null,o=[],s=0;s<i;++s){if((n=t.charCodeAt(s))>55295&&n<57344){if(!r){if(n>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(s+1===i){(e-=3)>-1&&o.push(239,191,189);continue}r=n;continue}if(n<56320){(e-=3)>-1&&o.push(239,191,189),r=n;continue}n=65536+(r-55296<<10|n-56320)}else r&&(e-=3)>-1&&o.push(239,191,189);if(r=null,n<128){if((e-=1)<0)break;o.push(n)}else if(n<2048){if((e-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function F(t){return i.toByteArray(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(L,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function z(t,e,n,i){for(var r=0;r<i&&!(r+n>=e.length||r>=t.length);++r)e[r+n]=t[r];return r}}).call(this,n(2))},function(t,e,n){"use strict";var i=n(11);function r(t,e){t.emit("error",e)}t.exports={destroy:function(t,e){var n=this,o=this._readableState&&this._readableState.destroyed,s=this._writableState&&this._writableState.destroyed;return o||s?(e?e(t):!t||this._writableState&&this._writableState.errorEmitted||i.nextTick(r,this,t),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,function(t){!e&&t?(i.nextTick(r,n,t),n._writableState&&(n._writableState.errorEmitted=!0)):e&&e(t)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(t,e,n){"use strict";var i=n(12).Buffer,r=i.isEncoding||function(t){switch((t=""+t)&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function o(t){var e;switch(this.encoding=function(t){var e=function(t){if(!t)return"utf8";for(var e;;)switch(t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:if(e)return;t=(""+t).toLowerCase(),e=!0}}(t);if("string"!=typeof e&&(i.isEncoding===r||!r(t)))throw new Error("Unknown encoding: "+t);return e||t}(t),this.encoding){case"utf16le":this.text=u,this.end=c,e=4;break;case"utf8":this.fillLast=a,e=4;break;case"base64":this.text=l,this.end=h,e=3;break;default:return this.write=f,void(this.end=p)}this.lastNeed=0,this.lastTotal=0,this.lastChar=i.allocUnsafe(e)}function s(t){return t<=127?0:t>>5==6?2:t>>4==14?3:t>>3==30?4:t>>6==2?-1:-2}function a(t){var e=this.lastTotal-this.lastNeed,n=function(t,e,n){if(128!=(192&e[0]))return t.lastNeed=0,"";if(t.lastNeed>1&&e.length>1){if(128!=(192&e[1]))return t.lastNeed=1,"";if(t.lastNeed>2&&e.length>2&&128!=(192&e[2]))return t.lastNeed=2,""}}(this,t);return void 0!==n?n:this.lastNeed<=t.length?(t.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(t.copy(this.lastChar,e,0,t.length),void(this.lastNeed-=t.length))}function u(t,e){if((t.length-e)%2==0){var n=t.toString("utf16le",e);if(n){var i=n.charCodeAt(n.length-1);if(i>=55296&&i<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=t[t.length-1],t.toString("utf16le",e,t.length-1)}function c(t){var e=t&&t.length?this.write(t):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,n)}return e}function l(t,e){var n=(t.length-e)%3;return 0===n?t.toString("base64",e):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=t[t.length-1]:(this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1]),t.toString("base64",e,t.length-n))}function h(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function f(t){return t.toString(this.encoding)}function p(t){return t&&t.length?this.write(t):""}e.StringDecoder=o,o.prototype.write=function(t){if(0===t.length)return"";var e,n;if(this.lastNeed){if(void 0===(e=this.fillLast(t)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<t.length?e?e+this.text(t,n):this.text(t,n):e||""},o.prototype.end=function(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+"":e},o.prototype.text=function(t,e){var n=function(t,e,n){var i=e.length-1;if(i<n)return 0;var r=s(e[i]);if(r>=0)return r>0&&(t.lastNeed=r-1),r;if(--i<n||-2===r)return 0;if((r=s(e[i]))>=0)return r>0&&(t.lastNeed=r-2),r;if(--i<n||-2===r)return 0;if((r=s(e[i]))>=0)return r>0&&(2===r?r=0:t.lastNeed=r-3),r;return 0}(this,t,e);if(!this.lastNeed)return t.toString("utf8",e);this.lastTotal=n;var i=t.length-(n-this.lastNeed);return t.copy(this.lastChar,0,i),t.toString("utf8",e,i)},o.prototype.fillLast=function(t){if(this.lastNeed<=t.length)return t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,t.length),this.lastNeed-=t.length}},function(t,e,n){"use strict";t.exports=o;var i=n(7),r=n(9);function o(t){if(!(this instanceof o))return new o(t);i.call(this,t),this._transformState={afterTransform:function(t,e){var n=this._transformState;n.transforming=!1;var i=n.writecb;if(!i)return this.emit("error",new Error("write callback called multiple times"));n.writechunk=null,n.writecb=null,null!=e&&this.push(e),i(t);var r=this._readableState;r.reading=!1,(r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,t&&("function"==typeof t.transform&&(this._transform=t.transform),"function"==typeof t.flush&&(this._flush=t.flush)),this.on("prefinish",s)}function s(){var t=this;"function"==typeof this._flush?this._flush(function(e,n){a(t,e,n)}):a(this,null,null)}function a(t,e,n){if(e)return t.emit("error",e);if(null!=n&&t.push(n),t._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(t._transformState.transforming)throw new Error("Calling transform done when still transforming");return t.push(null)}r.inherits=n(6),r.inherits(o,i),o.prototype.push=function(t,e){return this._transformState.needTransform=!1,i.prototype.push.call(this,t,e)},o.prototype._transform=function(t,e,n){throw new Error("_transform() is not implemented")},o.prototype._write=function(t,e,n){var i=this._transformState;if(i.writecb=n,i.writechunk=t,i.writeencoding=e,!i.transforming){var r=this._readableState;(i.needTransform||r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}},o.prototype._read=function(t){var e=this._transformState;null!==e.writechunk&&e.writecb&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0},o.prototype._destroy=function(t,e){var n=this;i.prototype._destroy.call(this,t,function(t){e(t),n.emit("close")})}},function(t,e,n){var i=n(71),r=n(72),o=n(1),s=n(3);function a(t,e,n,i){this.backend=t.backend,this.agent=t.agent,this.db=t.db,this.index=t.index,this.query=t.query,this.collection=t.collection,this.fields=t.fields,this.options=t.options,this.snapshotProjection=t.snapshotProjection,this.stream=e,this.ids=n,this.extra=i,this.skipPoll=this.options.skipPoll||s.doNothing,this.canPollDoc=this.db.canPollDoc(this.collection,this.query),this.pollDebounce="number"==typeof this.options.pollDebounce?this.options.pollDebounce:"number"==typeof this.db.pollDebounce?this.db.pollDebounce:0,this.pollInterval="number"==typeof this.options.pollInterval?this.options.pollInterval:"number"==typeof this.db.pollInterval?this.db.pollInterval:0,this._polling=!1,this._pendingPoll=null,this._pollDebounceId=null,this._pollIntervalId=null}t.exports=a,a.prototype._open=function(){var t=this;this._defaultCallback=function(e){e&&t.onError(e)},t.stream.on("data",function(e){if(e.error)return t.onError(e.error);t._update(e)}),t.stream.on("end",function(){t.destroy()}),this._flushPoll()},a.prototype.destroy=function(){clearTimeout(this._pollDebounceId),clearTimeout(this._pollIntervalId),this.stream.destroy()},a.prototype._emitTiming=function(t,e){this.backend.emit("timing",t,Date.now()-e,this)},a.prototype._update=function(t){var e=t.d;-1!==this.ids.indexOf(e)&&this.onOp(t);try{if(this.db.skipPoll(this.collection,e,t,this.query))return this._defaultCallback();if(this.skipPoll(this.collection,e,t,this.query))return this._defaultCallback()}catch(t){return this._defaultCallback(t)}this.canPollDoc?this.queryPollDoc(e,this._defaultCallback):this.queryPoll(this._defaultCallback)},a.prototype._flushPoll=function(){if(!this._polling&&!this._pollDebounceId)if(this._pendingPoll)this.queryPoll();else if(this.pollInterval){var t=this;this._pollIntervalId=setTimeout(function(){t._pollIntervalId=null,t.queryPoll(t._defaultCallback)},this.pollInterval)}},a.prototype.queryPoll=function(t){var e=this;if(this._polling||this._pollDebounceId)this._pendingPoll?this._pendingPoll.push(t):this._pendingPoll=[t];else{this._polling=!0;var n=this._pendingPoll;this._pendingPoll=null,this.pollDebounce&&(this._pollDebounceId=setTimeout(function(){e._pollDebounceId=null,e._flushPoll()},this.pollDebounce)),clearTimeout(this._pollIntervalId);var o=Date.now();this.db.queryPoll(this.collection,this.query,this.options,function(s,a,u){if(s)return e._finishPoll(s,t,n);e._emitTiming("queryEmitter.poll",o),r(e.extra,u)||(e.extra=u,e.onExtra(u));var c=i(e.ids,a);if(c.length){e.ids=a;var l=function(t){for(var e=[],n=0;n<t.length;n++){var r=t[n];if(r instanceof i.InsertDiff)for(var o=0;o<r.values.length;o++)e.push(r.values[o])}return e}(c);l.length?e.db.getSnapshotBulk(e.collection,l,e.fields,null,function(r,s){if(r)return e._finishPoll(r,t,n);var a=e.backend._getSnapshotsFromMap(l,s),u=e.backend.SNAPSHOT_TYPES.current;e.backend._sanitizeSnapshots(e.agent,e.snapshotProjection,e.collection,a,u,function(r){if(r)return e._finishPoll(r,t,n);e._emitTiming("queryEmitter.pollGetSnapshotBulk",o);var a=function(t,e){for(var n=[],r=0;r<t.length;r++){var o=t[r];if(o instanceof i.InsertDiff){for(var s=[],a=0;a<o.values.length;a++){var u=o.values[a];s.push(e[u])}n.push(new i.InsertDiff(o.index,s))}else n.push(o)}return n}(c,s);e.onDiff(a),e._finishPoll(r,t,n)})}):(e.onDiff(c),e._finishPoll(s,t,n))}else e._finishPoll(s,t,n)})}},a.prototype._finishPoll=function(t,e,n){if(this._polling=!1,e&&e(t),n)for(var i=0;i<n.length;i++)(e=n[i])&&e(t);this._flushPoll()},a.prototype.queryPollDoc=function(t,e){var n=this,r=Date.now();this.db.queryPollDoc(this.collection,t,this.query,this.options,function(o,s){if(o)return e(o);n._emitTiming("queryEmitter.pollDoc",r);var a=n.ids.indexOf(t);if(-1===a&&s){var u=n.ids.push(t)-1;n.db.getSnapshot(n.collection,t,n.fields,null,function(t,o){if(t)return e(t);var s=[o],a=n.backend.SNAPSHOT_TYPES.current;n.backend._sanitizeSnapshots(n.agent,n.snapshotProjection,n.collection,s,a,function(t){if(t)return e(t);n.onDiff([new i.InsertDiff(u,s)]),n._emitTiming("queryEmitter.pollDocGetSnapshot",r),e()})})}else{if(-1!==a&&!s)return n.ids.splice(a,1),n.onDiff([new i.RemoveDiff(a,1)]),e();e()}})},a.prototype.onError=a.prototype.onDiff=a.prototype.onExtra=a.prototype.onOp=function(){throw new o(5018,"Required QueryEmitter listener not assigned")}},function(t,e,n){var i=n(18),r=n(19);function o(t,e,n,i,r,o){this.backend=t,this.agent=e;var s=t.projections[n];this.index=n,this.projection=s,this.collection=s?s.target:n,this.id=i,this.op=r,this.options=o,this.start=Date.now(),this._addOpMeta(),this.action=null,this.custom={},this.saveMilestoneSnapshot=null,this.suppressPublish=t.suppressPublish,this.maxRetries=t.maxSubmitRetries,this.retries=0,this.snapshot=null,this.ops=[],this.channels=null}t.exports=o,o.prototype.submit=function(t){var e=this,n=this.backend,i=this.collection,r=this.id,o=this.op;n.db.getSnapshot(i,r,{$submit:!0},null,function(s,a){if(s)return t(s);if(e.snapshot=a,e._addSnapshotMeta(),null==o.v){if(o.create&&a.type&&o.src)return void n.db.getCommittedOpVersion(i,r,a,o,null,function(n,i){if(n)return t(n);null==i?t(e.alreadyCreatedError()):(o.v=i,t(e.alreadySubmittedError()))});o.v=a.v}if(o.v===a.v)return e.apply(t);if(o.v>a.v)return t(e.newerVersionError());var u=o.v;n.db.getOpsToSnapshot(i,r,u,a,null,function(n,i){return n?t(n):i.length!==a.v-u?t(e.missingOpsError()):(n=e._transformOp(i))?t(n):o.v!==a.v?t(e.versionAfterTransformError()):void e.apply(t)})})},o.prototype.apply=function(t){var e=this.projection;if(e&&!r.isOpAllowed(this.snapshot.type,e.fields,this.op))return t(this.projectionError());this.channels=this.backend.getChannels(this.collection,this.id);var n=this;this.backend.trigger("apply",this.agent,this,function(e){return e?t(e):(e=i.apply(n.snapshot,n.op))?t(e):void n.commit(t)})},o.prototype.commit=function(t){var e=this,n=this.backend;n.trigger("commit",this.agent,this,function(i){if(i)return t(i);n.db.commit(e.collection,e.id,e.op,e.snapshot,e.options,function(i,r){if(i)return t(i);if(!r)return e.retry(t);if(!e.suppressPublish){var o=e.op;o.c=e.collection,o.d=e.id,o.m=void 0,e.collection!==e.index&&(o.i=e.index),n.pubsub.publish(e.channels,o)}e._shouldSaveMilestoneSnapshot(e.snapshot)&&e.backend.milestoneDb.saveMilestoneSnapshot(e.collection,e.snapshot),t()})})},o.prototype.retry=function(t){if(this.retries++,null!=this.maxRetries&&this.retries>this.maxRetries)return t(this.maxRetriesError());this.backend.emit("timing","submit.retry",Date.now()-this.start,this),this.submit(t)},o.prototype._transformOp=function(t){for(var e=this.snapshot.type,n=0;n<t.length;n++){var r=t[n];if(this.op.src&&this.op.src===r.src&&this.op.seq===r.seq)return this.alreadySubmittedError();if(this.op.v!==r.v)return this.versionDuringTransformError();var o=i.transform(e,this.op,r);if(o)return o;this.ops.push(r)}},o.prototype._addOpMeta=function(){this.op.m={ts:this.start},this.op.create&&(this.op.create.type=i.normalizeType(this.op.create.type))},o.prototype._addSnapshotMeta=function(){var t=this.snapshot.m||(this.snapshot.m={});this.op.create?t.ctime=this.start:this.op.del&&(this.op.m.data=this.snapshot.data),t.mtime=this.start},o.prototype._shouldSaveMilestoneSnapshot=function(t){return null===this.saveMilestoneSnapshot?t&&t.v%this.backend.milestoneDb.interval==0:this.saveMilestoneSnapshot},o.prototype.alreadySubmittedError=function(){return{code:4001,message:"Op already submitted"}},o.prototype.rejectedError=function(){return{code:4002,message:"Op submit rejected"}},o.prototype.alreadyCreatedError=function(){return{code:4010,message:"Invalid op submitted. Document already created"}},o.prototype.newerVersionError=function(){return{code:4011,message:"Invalid op submitted. Op version newer than current snapshot"}},o.prototype.projectionError=function(){return{code:4012,message:"Invalid op submitted. Operation invalid in projected collection"}},o.prototype.missingOpsError=function(){return{code:5001,message:"Op submit failed. DB missing ops needed to transform it up to the current snapshot version"}},o.prototype.versionDuringTransformError=function(){return{code:5002,message:"Op submit failed. Versions mismatched during op transform"}},o.prototype.versionAfterTransformError=function(){return{code:5003,message:"Op submit failed. Op version mismatches snapshot after op transform"}},o.prototype.maxRetriesError=function(){return{code:5004,message:"Op submit failed. Maximum submit retries exceeded"}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(13),r=n(47),o=n(20),s=n(10);window.SDB={ReconnectingWebsocket:s.ReconnectingWebsocket,SDBClient:r.SDBClient,SDBDoc:i.SDBDoc,SDBSubDoc:o.SDBSubDoc}},function(t,e,n){"use strict";t.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(48),r=n(75),o=n(10);e.ReconnectingWebsocket=o.ReconnectingWebsocket;e.SDBClient=class extends i.SDB{constructor(t){super(),this.ws=t,this.connection=new r.Connection(t)}close(){return Promise.resolve()}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(49),r=n(13);e.SDB=class{constructor(){this.docs=new Map}getDocIdentifier(t,e){return[t,e]}get(t,e){const n=this.getDocIdentifier(t,e);let i;if(this.docs.has(n))i=this.docs.get(n);else{const o=this.connection.get(t,e);i=new r.SDBDoc(n,o,this),this.docs.set(n,i)}return i}static registerType(t){i.types.register(t)}deleteDoc(t){this.docs.delete(t.getIdentifier())}}},function(t,e,n){var i=n(50);t.exports=i,i.Agent=n(24),i.Backend=i,i.DB=n(31),i.Error=n(1),i.MemoryDB=n(30),i.MemoryMilestoneDB=n(74),i.MemoryPubSub=n(32),i.MilestoneDB=n(15),i.ot=n(18),i.projections=n(19),i.PubSub=n(33),i.QueryEmitter=n(43),i.SubmitRequest=n(44),i.types=n(4)},function(t,e,n){var i=n(22),r=n(24),o=n(27),s=n(5),a=n(30),u=n(57),c=n(32),l=n(18),h=n(19),f=n(43),p=n(14),d=n(73),y=n(44),g=n(4),v=!0,b=!0;function m(t){if(!(this instanceof m))return new m(t);s.EventEmitter.call(this),t||(t={}),this.db=t.db||new a,this.pubsub=t.pubsub||new c,this.extraDbs=t.extraDbs||{},this.milestoneDb=t.milestoneDb||new u,this.projections={},this.suppressPublish=!!t.suppressPublish,this.maxSubmitRetries=t.maxSubmitRetries||null,this.middleware={},this.agentsCount=0,this.remoteAgentsCount=0,t.disableDocAction||this._shimDocAction(),t.disableSpaceDelimitedActions||this._shimAfterSubmit()}function w(t){for(var e in t)t[e].destroy()}t.exports=m,s.mixin(m),m.prototype.MIDDLEWARE_ACTIONS={afterSubmit:"afterSubmit","after submit":"after submit",apply:"apply",commit:"commit",connect:"connect",doc:"doc",op:"op",query:"query",receive:"receive",readSnapshots:"readSnapshots",submit:"submit"},m.prototype.SNAPSHOT_TYPES={current:"current",byVersion:"byVersion"},m.prototype._shimDocAction=function(){v&&(v=!1,console.warn('DEPRECATED: "doc" middleware action. Use "readSnapshots" instead. Pass `disableDocAction: true` option to ShareDB to disable the "doc" action and this warning.'));var t=this;this.use(this.MIDDLEWARE_ACTIONS.readSnapshots,function(e,n){i.each(e.snapshots,function(n,i){var r={collection:e.collection,id:n.id,snapshot:n};t.trigger(t.MIDDLEWARE_ACTIONS.doc,e.agent,r,i)},n)})},m.prototype._shimAfterSubmit=function(){b&&(b=!1,console.warn('DEPRECATED: "after submit" middleware action. Use "afterSubmit" instead. Pass `disableSpaceDelimitedActions: true` option to ShareDB to disable the "after submit" action and this warning.'));var t=this;this.use(t.MIDDLEWARE_ACTIONS.afterSubmit,function(e,n){t.trigger(t.MIDDLEWARE_ACTIONS["after submit"],e.agent,e,n)})},m.prototype.close=function(t){var e=4,n=this;function i(i){if(i)return t?t(i):n.emit("error",i);--e||t&&t()}for(var r in this.pubsub.close(i),this.db.close(i),this.milestoneDb.close(i),this.extraDbs)e++,this.extraDbs[r].close(i);i()},m.prototype.connect=function(t,e){var n=new d;t?t.bindToSocket(n):t=new o(n),n._open();var i=this.listen(n.stream,e);return t.agent=i,t},m.prototype.listen=function(t,e){var n=new r(this,t);return this.trigger(this.MIDDLEWARE_ACTIONS.connect,n,{stream:t,req:e},function(t){if(t)return n.close(t);n._open()}),n},m.prototype.addProjection=function(t,e,n){if(this.projections[t])throw new Error("Projection "+t+" already exists");for(var i in n)if(!0!==n[i])throw new Error("Invalid field "+i+" - fields must be {somekey: true}. Subfields not currently supported.");this.projections[t]={target:e,fields:n}},m.prototype.use=function(t,e){if(!Array.isArray(t))return(this.middleware[t]||(this.middleware[t]=[])).push(e),this;for(var n=0;n<t.length;n++)this.use(t[n],e)},m.prototype.trigger=function(t,e,n,i){n.action=t,n.agent=e,n.backend=this;var r=this.middleware[t];if(!r)return i();r=r.slice();var o=function(t){if(t)return i(t);var e=r.shift();if(!e)return i();e(n,o)};o()},m.prototype.submit=function(t,e,n,i,r,o){var s=l.checkOp(i);if(s)return o(s);var a=new y(this,t,e,n,i,r),u=this;u.trigger(u.MIDDLEWARE_ACTIONS.submit,t,a,function(e){if(e)return o(e);a.submit(function(e){if(e)return o(e);u.trigger(u.MIDDLEWARE_ACTIONS.afterSubmit,t,a,function(e){if(e)return o(e);u._sanitizeOps(t,a.projection,a.collection,n,a.ops,function(t){if(t)return o(t);u.emit("timing","submit.total",Date.now()-a.start,a),o(t,a.ops)})})})})},m.prototype._sanitizeOp=function(t,e,n,i,r,o){if(e)try{h.projectOp(e.fields,r)}catch(t){return o(t)}this.trigger(this.MIDDLEWARE_ACTIONS.op,t,{collection:n,id:i,op:r},o)},m.prototype._sanitizeOps=function(t,e,n,r,o,s){var a=this;i.each(o,function(i,o){a._sanitizeOp(t,e,n,r,i,o)},s)},m.prototype._sanitizeOpsBulk=function(t,e,n,r,o){var s=this;i.forEachOf(r,function(i,r,o){s._sanitizeOps(t,e,n,r,i,o)},o)},m.prototype._sanitizeSnapshots=function(t,e,n,i,r,o){if(e)try{h.projectSnapshots(e.fields,i)}catch(t){return o(t)}var s={collection:n,snapshots:i,snapshotType:r};this.trigger(this.MIDDLEWARE_ACTIONS.readSnapshots,t,s,o)},m.prototype._getSnapshotProjection=function(t,e){return t.projectsSnapshots?null:e},m.prototype._getSnapshotsFromMap=function(t,e){for(var n=new Array(t.length),i=0;i<t.length;i++){var r=t[i];n[i]=e[r]}return n},m.prototype.getOps=function(t,e,n,i,r,o){var s=Date.now(),a=this.projections[e],u=a?a.target:e,c=this,l={agent:t,index:e,collection:u,id:n,from:i,to:r};c.db.getOps(u,n,i,r,null,function(e,i){if(e)return o(e);c._sanitizeOps(t,a,u,n,i,function(t){if(t)return o(t);c.emit("timing","getOps",Date.now()-s,l),o(t,i)})})},m.prototype.getOpsBulk=function(t,e,n,i,r){var o=Date.now(),s=this.projections[e],a=s?s.target:e,u=this,c={agent:t,index:e,collection:a,fromMap:n,toMap:i};u.db.getOpsBulk(a,n,i,null,function(e,n){if(e)return r(e);u._sanitizeOpsBulk(t,s,a,n,function(t){if(t)return r(t);u.emit("timing","getOpsBulk",Date.now()-o,c),r(t,n)})})},m.prototype.fetch=function(t,e,n,i){var r=Date.now(),o=this.projections[e],s=o?o.target:e,a=o&&o.fields,u=this,c={agent:t,index:e,collection:s,id:n};u.db.getSnapshot(s,n,a,null,function(e,n){if(e)return i(e);var a=u._getSnapshotProjection(u.db,o),l=[n];u._sanitizeSnapshots(t,a,s,l,u.SNAPSHOT_TYPES.current,function(t){if(t)return i(t);u.emit("timing","fetch",Date.now()-r,c),i(null,n)})})},m.prototype.fetchBulk=function(t,e,n,i){var r=Date.now(),o=this.projections[e],s=o?o.target:e,a=o&&o.fields,u=this,c={agent:t,index:e,collection:s,ids:n};u.db.getSnapshotBulk(s,n,a,null,function(e,a){if(e)return i(e);var l=u._getSnapshotProjection(u.db,o),h=u._getSnapshotsFromMap(n,a);u._sanitizeSnapshots(t,l,s,h,u.SNAPSHOT_TYPES.current,function(t){if(t)return i(t);u.emit("timing","fetchBulk",Date.now()-r,c),i(null,a)})})},m.prototype.subscribe=function(t,e,n,i,r){var o=Date.now(),s=this.projections[e],a=s?s.target:e,u=this.getDocChannel(a,n),c=this,l={agent:t,index:e,collection:a,id:n,version:i};c.pubsub.subscribe(u,function(u,h){if(u)return r(u);h.initProjection(c,t,s),null==i?c.fetch(t,e,n,function(t,e){if(t)return r(t);c.emit("timing","subscribe.snapshot",Date.now()-o,l),r(null,h,e)}):c.db.getOps(a,n,i,null,null,function(t,e){if(t)return r(t);h.pushOps(a,n,e),c.emit("timing","subscribe.ops",Date.now()-o,l),r(null,h)})})},m.prototype.subscribeBulk=function(t,e,n,r){var o=Date.now(),s=this.projections[e],a=s?s.target:e,u=this,c={},l=Array.isArray(n),h=l?n:Object.keys(n),f={agent:t,index:e,collection:a,versions:n};i.each(h,function(e,n){var i=u.getDocChannel(a,e);u.pubsub.subscribe(i,function(i,r){if(i)return n(i);r.initProjection(u,t,s),c[e]=r,n()})},function(i){if(i)return w(c),r(i);l?u.fetchBulk(t,e,h,function(t,e){if(t)return w(c),r(t);u.emit("timing","subscribeBulk.snapshot",Date.now()-o,f),r(null,c,e)}):u.db.getOpsBulk(a,n,null,null,function(t,e){if(t)return w(c),r(t);for(var n in e){var i=e[n];c[n].pushOps(a,n,i)}u.emit("timing","subscribeBulk.ops",Date.now()-o,f),r(null,c)})})},m.prototype.queryFetch=function(t,e,n,i,r){var o=Date.now(),s=this;s._triggerQuery(t,e,n,i,function(e,n){if(e)return r(e);s._query(t,n,function(t,e,i){if(t)return r(t);s.emit("timing","queryFetch",Date.now()-o,n),r(null,e,i)})})},m.prototype.querySubscribe=function(t,e,n,i,r){var o=Date.now(),s=this;s._triggerQuery(t,e,n,i,function(e,n){return e?r(e):n.db.disableSubscribe?r({code:4002,message:"DB does not support subscribe"}):void s.pubsub.subscribe(n.channel,function(e,a){if(e)return r(e);if(a.initProjection(s,t,n.projection),i.ids){var u=new f(n,a,i.ids);return s.emit("timing","querySubscribe.reconnect",Date.now()-o,n),void r(null,u)}s._query(t,n,function(t,e,i){if(t)return a.destroy(),r(t);var u=function(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n].id);return e}(e),c=new f(n,a,u,i);s.emit("timing","querySubscribe.initial",Date.now()-o,n),r(null,c,e,i)})})})},m.prototype._triggerQuery=function(t,e,n,i,r){var o=this.projections[e],s=o?o.target:e,a=o&&o.fields,u={index:e,collection:s,projection:o,fields:a,channel:this.getCollectionChannel(s),query:n,options:i,db:null,snapshotProjection:null},c=this;c.trigger(c.MIDDLEWARE_ACTIONS.query,t,u,function(t){return t?r(t):(u.db=i.db?c.extraDbs[i.db]:c.db,u.db?(u.snapshotProjection=c._getSnapshotProjection(u.db,o),void r(null,u)):r({code:4003,message:"DB not found"}))})},m.prototype._query=function(t,e,n){var i=this;e.db.query(e.collection,e.query,e.fields,e.options,function(r,o,s){if(r)return n(r);i._sanitizeSnapshots(t,e.snapshotProjection,e.collection,o,i.SNAPSHOT_TYPES.current,function(t){n(t,o,s)})})},m.prototype.getCollectionChannel=function(t){return t},m.prototype.getDocChannel=function(t,e){return t+"."+e},m.prototype.getChannels=function(t,e){return[this.getCollectionChannel(t),this.getDocChannel(t,e)]},m.prototype.fetchSnapshot=function(t,e,n,i,r){var o=Date.now(),s=this,a=this.projections[e],u=a?a.target:e,c={agent:t,index:e,collection:u,id:n,version:i};this._fetchSnapshot(u,n,i,function(e,n){if(e)return r(e);var i=s._getSnapshotProjection(s.db,a),l=[n],h=s.SNAPSHOT_TYPES.byVersion;s._sanitizeSnapshots(t,i,u,l,h,function(t){if(t)return r(t);s.emit("timing","fetchSnapshot",Date.now()-o,c),r(null,n)})})},m.prototype._fetchSnapshot=function(t,e,n,i){var r=this.db;this.milestoneDb.getMilestoneSnapshot(t,e,n,function(o,s){if(o)return i(o);var a=s?s.v:0;r.getOps(t,e,a,n,null,function(t,r){if(t)return i(t);var o,a=null,u=0;if(s){if(!(a=g.map[s.type]))return i({code:4008,message:"Unknown type"});o=s.data,u=s.v}for(var c=0;c<r.length;c++){var l=r[c];if(u=l.v+1,l.create){if(!(a=g.map[l.create.type]))return i({code:4008,message:"Unknown type"});o=a.create(l.create.data)}else l.del?(o=void 0,a=null):o=a.apply(o,l.op)}if(a=a?a.uri:null,n>u)return i({code:4024,message:"Requested version exceeds latest snapshot version"});var h=new p(e,u,a,o,null);i(null,h)})})}},function(t,e,n){(function(t,e){!function(t,n){"use strict";if(!t.setImmediate){var i,r=1,o={},s=!1,a=t.document,u=Object.getPrototypeOf&&Object.getPrototypeOf(t);u=u&&u.setTimeout?u:t,"[object process]"==={}.toString.call(t.process)?i=function(t){e.nextTick(function(){l(t)})}:function(){if(t.postMessage&&!t.importScripts){var e=!0,n=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=n,e}}()?function(){var e="setImmediate$"+Math.random()+"$",n=function(n){n.source===t&&"string"==typeof n.data&&0===n.data.indexOf(e)&&l(+n.data.slice(e.length))};t.addEventListener?t.addEventListener("message",n,!1):t.attachEvent("onmessage",n),i=function(n){t.postMessage(e+n,"*")}}():t.MessageChannel?function(){var t=new MessageChannel;t.port1.onmessage=function(t){l(t.data)},i=function(e){t.port2.postMessage(e)}}():a&&"onreadystatechange"in a.createElement("script")?function(){var t=a.documentElement;i=function(e){var n=a.createElement("script");n.onreadystatechange=function(){l(e),n.onreadystatechange=null,t.removeChild(n),n=null},t.appendChild(n)}}():i=function(t){setTimeout(l,0,t)},u.setImmediate=function(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),n=0;n<e.length;n++)e[n]=arguments[n+1];var s={callback:t,args:e};return o[r]=s,i(r),r++},u.clearImmediate=c}function c(t){delete o[t]}function l(t){if(s)setTimeout(l,0,t);else{var e=o[t];if(e){s=!0;try{!function(t){var e=t.callback,i=t.args;switch(i.length){case 0:e();break;case 1:e(i[0]);break;case 2:e(i[0],i[1]);break;case 3:e(i[0],i[1],i[2]);break;default:e.apply(n,i)}}(e)}finally{c(t),s=!1}}}}}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,n(2),n(0))},function(t,e){var n=t.exports=function(t,e){if(e||(e=16),void 0===t&&(t=128),t<=0)return"0";for(var i=Math.log(Math.pow(2,t))/Math.log(e),r=2;i===1/0;r*=2)i=Math.log(Math.pow(2,t/r))/Math.log(e)*r;var o=i-Math.floor(i),s="";for(r=0;r<Math.floor(i);r++){s=Math.floor(Math.random()*e).toString(e)+s}if(o){var a=Math.pow(e,o);s=Math.floor(Math.random()*a).toString(e)+s}var u=parseInt(s,e);return u!==1/0&&u>=Math.pow(2,t)?n(t,e):s};n.rack=function(t,e,i){var r=function(r){var s=0;do{if(s++>10){if(!i)throw new Error("too many ID collisions, use more bits");t+=i}var a=n(t,e)}while(Object.hasOwnProperty.call(o,a));return o[a]=r,a},o=r.hats={};return r.get=function(t){return r.hats[t]},r.set=function(t,e){return r.hats[t]=e,r},r.bits=t||128,r.base=e||16,r}},function(t,e,n){var i=function(t){return"[object Array]"==Object.prototype.toString.call(t)},r=function(t){return JSON.parse(JSON.stringify(t))},o={name:"json0",uri:"http://sharejs.org/types/JSONv0"},s={};function a(t){t.t="text0";var e={p:t.p.pop()};null!=t.si&&(e.i=t.si),null!=t.sd&&(e.d=t.sd),t.o=[e]}function u(t){t.p.push(t.o[0].p),null!=t.o[0].i&&(t.si=t.o[0].i),null!=t.o[0].d&&(t.sd=t.o[0].d),delete t.t,delete t.o}o.registerSubtype=function(t){s[t.name]=t},o.create=function(t){return void 0===t?null:r(t)},o.invertComponent=function(t){var e={p:t.p};return t.t&&s[t.t]&&(e.t=t.t,e.o=s[t.t].invert(t.o)),void 0!==t.si&&(e.sd=t.si),void 0!==t.sd&&(e.si=t.sd),void 0!==t.oi&&(e.od=t.oi),void 0!==t.od&&(e.oi=t.od),void 0!==t.li&&(e.ld=t.li),void 0!==t.ld&&(e.li=t.ld),void 0!==t.na&&(e.na=-t.na),void 0!==t.lm&&(e.lm=t.p[t.p.length-1],e.p=t.p.slice(0,t.p.length-1).concat([t.lm])),e},o.invert=function(t){for(var e=t.slice().reverse(),n=[],i=0;i<e.length;i++)n.push(o.invertComponent(e[i]));return n},o.checkValidOp=function(t){for(var e=0;e<t.length;e++)if(!i(t[e].p))throw new Error("Missing path")},o.checkList=function(t){if(!i(t))throw new Error("Referenced element not a list")},o.checkObj=function(t){if(!function(t){return!!t&&t.constructor===Object}(t))throw new Error("Referenced element not an object (it was "+JSON.stringify(t)+")")},o.apply=function(t,e){o.checkValidOp(e),e=r(e);for(var n={data:t},i=0;i<e.length;i++){var u=e[i];null==u.si&&null==u.sd||a(u);for(var c=null,l=n,h="data",f=0;f<u.p.length;f++){var p=u.p[f];if(c=l,h,l=l[h],h=p,null==c)throw new Error("Path invalid")}if(u.t&&void 0!==u.o&&s[u.t])l[h]=s[u.t].apply(l[h],u.o);else if(void 0!==u.na){if("number"!=typeof l[h])throw new Error("Referenced element not a number");l[h]+=u.na}else if(void 0!==u.li&&void 0!==u.ld)o.checkList(l),l[h]=u.li;else if(void 0!==u.li)o.checkList(l),l.splice(h,0,u.li);else if(void 0!==u.ld)o.checkList(l),l.splice(h,1);else if(void 0!==u.lm){if(o.checkList(l),u.lm!=h){var d=l[h];l.splice(h,1),l.splice(u.lm,0,d)}}else if(void 0!==u.oi)o.checkObj(l),l[h]=u.oi;else{if(void 0===u.od)throw new Error("invalid / missing instruction in op");o.checkObj(l),delete l[h]}}return n.data},o.shatter=function(t){for(var e=[],n=0;n<t.length;n++)e.push([t[n]]);return e},o.incrementalApply=function(t,e,n){for(var i=0;i<e.length;i++){var r=[e[i]];n(r,t=o.apply(t,r))}return t};var c=o.pathMatches=function(t,e,n){if(t.length!=e.length)return!1;for(var i=0;i<t.length;i++)if(t[i]!==e[i]&&(!n||i!==t.length-1))return!1;return!0};o.append=function(t,e){if(e=r(e),0!==t.length){var n=t[t.length-1];if(null==e.si&&null==e.sd||null==n.si&&null==n.sd||(a(e),a(n)),c(e.p,n.p))if(e.t&&n.t&&e.t===n.t&&s[e.t]){if(n.o=s[e.t].compose(n.o,e.o),null!=e.si||null!=e.sd){for(var i=e.p,o=0;o<n.o.length-1;o++)e.o=[n.o.pop()],e.p=i.slice(),u(e),t.push(e);u(n)}}else null!=n.na&&null!=e.na?t[t.length-1]={p:n.p,na:n.na+e.na}:void 0!==n.li&&void 0===e.li&&e.ld===n.li?void 0!==n.ld?delete n.li:t.pop():void 0!==n.od&&void 0===n.oi&&void 0!==e.oi&&void 0===e.od?n.oi=e.oi:void 0!==n.oi&&void 0!==e.od?void 0!==e.oi?n.oi=e.oi:void 0!==n.od?delete n.oi:t.pop():void 0!==e.lm&&e.p[e.p.length-1]===e.lm||t.push(e);else null==e.si&&null==e.sd||null==n.si&&null==n.sd||(u(e),u(n)),t.push(e)}else t.push(e)},o.compose=function(t,e){o.checkValidOp(t),o.checkValidOp(e);for(var n=r(t),i=0;i<e.length;i++)o.append(n,e[i]);return n},o.normalize=function(t){var e=[];t=i(t)?t:[t];for(var n=0;n<t.length;n++){var r=t[n];null==r.p&&(r.p=[]),o.append(e,r)}return e},o.commonLengthForOps=function(t,e){var n=t.p.length,i=e.p.length;if((null!=t.na||t.t)&&n++,(null!=e.na||e.t)&&i++,0===n)return-1;if(0===i)return null;n--,i--;for(var r=0;r<n;r++){var o=t.p[r];if(r>=i||o!==e.p[r])return null}return n},o.canOpAffectPath=function(t,e){return null!=o.commonLengthForOps({p:e},t)},o.transformComponent=function(t,e,n,c){e=r(e);var l=o.commonLengthForOps(n,e),h=o.commonLengthForOps(e,n),f=e.p.length,p=n.p.length;if((null!=e.na||e.t)&&f++,(null!=n.na||n.t)&&p++,null!=h&&p>f&&e.p[h]==n.p[h])if(void 0!==e.ld)(y=r(n)).p=y.p.slice(f),e.ld=o.apply(r(e.ld),[y]);else if(void 0!==e.od){(y=r(n)).p=y.p.slice(f),e.od=o.apply(r(e.od),[y])}if(null!=l){var d=f==p,y=n;if(null==e.si&&null==e.sd||null==n.si&&null==n.sd||(a(e),a(y=r(n))),y.t&&s[y.t]){if(e.t&&e.t===y.t){var g=s[e.t].transform(e.o,y.o,c);if(null!=e.si||null!=e.sd)for(var v=e.p,b=0;b<g.length;b++)e.o=[g[b]],e.p=v.slice(),u(e),o.append(t,e);else(!i(g)||g.length>0)&&(e.o=g,o.append(t,e));return t}}else if(void 0!==n.na);else if(void 0!==n.li&&void 0!==n.ld){if(n.p[l]===e.p[l]){if(!d)return t;if(void 0!==e.ld){if(void 0===e.li||"left"!==c)return t;e.ld=r(n.li)}}}else if(void 0!==n.li)void 0!==e.li&&void 0===e.ld&&d&&e.p[l]===n.p[l]?"right"===c&&e.p[l]++:n.p[l]<=e.p[l]&&e.p[l]++,void 0!==e.lm&&d&&n.p[l]<=e.lm&&e.lm++;else if(void 0!==n.ld){if(void 0!==e.lm&&d){if(n.p[l]===e.p[l])return t;v=n.p[l];var m=e.p[l];(v<(w=e.lm)||v===w&&m<w)&&e.lm--}if(n.p[l]<e.p[l])e.p[l]--;else if(n.p[l]===e.p[l]){if(p<f)return t;if(void 0!==e.ld){if(void 0===e.li)return t;delete e.ld}}}else if(void 0!==n.lm)if(void 0!==e.lm&&f===p){m=e.p[l];var w=e.lm,_=n.p[l],S=n.lm;if(_!==S)if(m===_){if("left"!==c)return t;e.p[l]=S,m===w&&(e.lm=S)}else m>_&&e.p[l]--,m>S?e.p[l]++:m===S&&_>S&&(e.p[l]++,m===w&&e.lm++),w>_?e.lm--:w===_&&w>m&&e.lm--,w>S?e.lm++:w===S&&(S>_&&w>m||S<_&&w<m?"right"===c&&e.lm++:w>m?e.lm++:w===_&&e.lm--)}else if(void 0!==e.li&&void 0===e.ld&&d){m=n.p[l],w=n.lm;(v=e.p[l])>m&&e.p[l]--,v>w&&e.p[l]++}else{m=n.p[l],w=n.lm;(v=e.p[l])===m?e.p[l]=w:(v>m&&e.p[l]--,v>w?e.p[l]++:v===w&&m>w&&e.p[l]++)}else if(void 0!==n.oi&&void 0!==n.od){if(e.p[l]===n.p[l]){if(void 0===e.oi||!d)return t;if("right"===c)return t;e.od=n.oi}}else if(void 0!==n.oi){if(void 0!==e.oi&&e.p[l]===n.p[l]){if("left"!==c)return t;o.append(t,{p:e.p,od:n.oi})}}else if(void 0!==n.od&&e.p[l]==n.p[l]){if(!d)return t;if(void 0===e.oi)return t;delete e.od}}return o.append(t,e),t},n(26)(o,o.transformComponent,o.checkValidOp,o.append);var l=n(54);o.registerSubtype(l),t.exports=o},function(t,e,n){var i=t.exports={name:"text0",uri:"http://sharejs.org/types/textv0",create:function(t){if(null!=t&&"string"!=typeof t)throw new Error("Initial data must be a string");return t||""}},r=function(t,e,n){return t.slice(0,e)+n+t.slice(e)},o=function(t){if("number"!=typeof t.p)throw new Error("component missing position field");if("string"==typeof t.i==("string"==typeof t.d))throw new Error("component needs an i or d field");if(t.p<0)throw new Error("position cannot be negative")},s=function(t){for(var e=0;e<t.length;e++)o(t[e])};i.apply=function(t,e){var n;s(e);for(var i=0;i<e.length;i++){var o=e[i];if(null!=o.i)t=r(t,o.p,o.i);else{if(n=t.slice(o.p,o.p+o.d.length),o.d!==n)throw new Error("Delete component '"+o.d+"' does not match deleted text '"+n+"'");t=t.slice(0,o.p)+t.slice(o.p+o.d.length)}}return t};var a=i._append=function(t,e){if(""!==e.i&&""!==e.d)if(0===t.length)t.push(e);else{var n=t[t.length-1];null!=n.i&&null!=e.i&&n.p<=e.p&&e.p<=n.p+n.i.length?t[t.length-1]={i:r(n.i,e.p-n.p,e.i),p:n.p}:null!=n.d&&null!=e.d&&e.p<=n.p&&n.p<=e.p+e.d.length?t[t.length-1]={d:r(e.d,n.p-e.p,n.d),p:e.p}:t.push(e)}};i.compose=function(t,e){s(t),s(e);for(var n=t.slice(),i=0;i<e.length;i++)a(n,e[i]);return n},i.normalize=function(t){var e=[];null==t.i&&null==t.p||(t=[t]);for(var n=0;n<t.length;n++){var i=t[n];null==i.p&&(i.p=0),a(e,i)}return e};var u=function(t,e,n){return null!=e.i?e.p<t||e.p===t&&n?t+e.i.length:t:t<=e.p?t:t<=e.p+e.d.length?e.p:t-e.d.length};i.transformCursor=function(t,e,n){for(var i="right"===n,r=0;r<e.length;r++)t=u(t,e[r],i);return t};var c=i._tc=function(t,e,n,i){if(o(e),o(n),null!=e.i)a(t,{i:e.i,p:u(e.p,n,"right"===i)});else if(null!=n.i){var r=e.d;e.p<n.p&&(a(t,{d:r.slice(0,n.p-e.p),p:e.p}),r=r.slice(n.p-e.p)),""!==r&&a(t,{d:r,p:e.p+n.i.length})}else if(e.p>=n.p+n.d.length)a(t,{d:e.d,p:e.p-n.d.length});else if(e.p+e.d.length<=n.p)a(t,e);else{var s={d:"",p:e.p};e.p<n.p&&(s.d=e.d.slice(0,n.p-e.p)),e.p+e.d.length>n.p+n.d.length&&(s.d+=e.d.slice(n.p+n.d.length-e.p));var c=Math.max(e.p,n.p),l=Math.min(e.p+e.d.length,n.p+n.d.length);if(e.d.slice(c-e.p,l-e.p)!==n.d.slice(c-n.p,l-n.p))throw new Error("Delete ops delete different text in the same region of the document");""!==s.d&&(s.p=u(s.p,n),a(t,s))}return t},l=function(t){return null!=t.i?{d:t.i,p:t.p}:{i:t.d,p:t.p}};i.invert=function(t){t=t.slice().reverse();for(var e=0;e<t.length;e++)t[e]=l(t[e]);return t},n(26)(i,c,s,a)},function(t,e,n){"use strict";var i="undefined"!=typeof Reflect?Reflect.construct:void 0,r=Object.defineProperty,o=Error.captureStackTrace;function s(t){void 0!==t&&r(this,"message",{configurable:!0,value:t,writable:!0});var e=this.constructor.name;void 0!==e&&e!==this.name&&r(this,"name",{configurable:!0,value:e,writable:!0}),o(this,this.constructor)}void 0===o&&(o=function(t){var e=new Error;r(t,"stack",{configurable:!0,get:function(){var t=e.stack;return r(this,"stack",{configurable:!0,value:t,writable:!0}),t},set:function(e){r(t,"stack",{configurable:!0,value:e,writable:!0})}})}),s.prototype=Object.create(Error.prototype,{constructor:{configurable:!0,value:s,writable:!0}});var a=function(){function t(t,e){return r(t,"name",{configurable:!0,value:e})}try{var e=function(){};if(t(e,"foo"),"foo"===e.name)return t}catch(t){}}();(t.exports=function(t,e){if(null==e||e===Error)e=s;else if("function"!=typeof e)throw new TypeError("super_ should be a function");var n;if("string"==typeof t)n=t,t=void 0!==i?function(){return i(e,arguments,this.constructor)}:function(){e.apply(this,arguments)},void 0!==a&&(a(t,n),n=void 0);else if("function"!=typeof t)throw new TypeError("constructor should be either a string or a function");t.super_=t.super=e;var r={constructor:{configurable:!0,value:t,writable:!0}};return void 0!==n&&(r.name={configurable:!0,value:n,writable:!0}),t.prototype=Object.create(e.prototype,r),t}).BaseError=s},function(t,e,n){var i=n(14),r=n(3),o=n(5);function s(t,e,n,i,s,a){if(o.EventEmitter.call(this),"function"!=typeof a)throw new Error("Callback is required for SnapshotRequest");if(!r.isValidVersion(s))throw new Error("Snapshot version must be a positive integer or null");this.requestId=e,this.connection=t,this.id=i,this.collection=n,this.version=s,this.callback=a,this.sent=!1}t.exports=s,o.mixin(s),s.prototype.send=function(){if(this.connection.canSend){var t={a:"nf",id:this.requestId,c:this.collection,d:this.id,v:this.version};this.connection.send(t),this.sent=!0}},s.prototype._onConnectionStateChanged=function(){this.connection.canSend&&!this.sent?this.send():this.connection.canSend||(this.sent=!1)},s.prototype._handleResponse=function(t,e){if(this.emit("ready"),t)return this.callback(t);var n=new i(this.id,e.v,e.type,e.data,null);this.callback(null,n)}},function(t,e,n){(function(e){var i=n(15);function r(t){i.call(this,t)}t.exports=r,r.prototype=Object.create(i.prototype),r.prototype.getMilestoneSnapshot=function(t,n,i,r){e.nextTick(r,null,void 0)},r.prototype.saveMilestoneSnapshot=function(t,n,i){if(i)return e.nextTick(i,null);this.emit("save",t,n)}}).call(this,n(0))},function(t,e,n){var i=n(34).inherits,r=n(35).Readable,o=n(3);function s(){r.call(this,{objectMode:!0}),this.id=null,this.backend=null,this.agent=null,this.projection=null,this.open=!0}t.exports=s,i(s,r),s.prototype._read=o.doNothing,s.prototype.initProjection=function(t,e,n){this.backend=t,this.agent=e,this.projection=n},s.prototype.pushOp=function(t,e,n){if(this.backend){var i=this;this.backend._sanitizeOp(this.agent,this.projection,t,e,n,function(t){i.open&&i.push(t?{error:t}:n)})}else{if(!this.open)return;this.push(n)}},s.prototype.pushOps=function(t,e,n){for(var i=0;i<n.length;i++)this.pushOp(t,e,n[i])},s.prototype.destroy=function(){this.open&&(this.open=!1,this.push(null),this.emit("close"))}},function(t,e){t.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},function(t,e,n){"use strict";e.byteLength=function(t){var e=c(t),n=e[0],i=e[1];return 3*(n+i)/4-i},e.toByteArray=function(t){for(var e,n=c(t),i=n[0],s=n[1],a=new o(function(t,e,n){return 3*(e+n)/4-n}(0,i,s)),u=0,l=s>0?i-4:i,h=0;h<l;h+=4)e=r[t.charCodeAt(h)]<<18|r[t.charCodeAt(h+1)]<<12|r[t.charCodeAt(h+2)]<<6|r[t.charCodeAt(h+3)],a[u++]=e>>16&255,a[u++]=e>>8&255,a[u++]=255&e;2===s&&(e=r[t.charCodeAt(h)]<<2|r[t.charCodeAt(h+1)]>>4,a[u++]=255&e);1===s&&(e=r[t.charCodeAt(h)]<<10|r[t.charCodeAt(h+1)]<<4|r[t.charCodeAt(h+2)]>>2,a[u++]=e>>8&255,a[u++]=255&e);return a},e.fromByteArray=function(t){for(var e,n=t.length,r=n%3,o=[],s=0,a=n-r;s<a;s+=16383)o.push(h(t,s,s+16383>a?a:s+16383));1===r?(e=t[n-1],o.push(i[e>>2]+i[e<<4&63]+"==")):2===r&&(e=(t[n-2]<<8)+t[n-1],o.push(i[e>>10]+i[e>>4&63]+i[e<<2&63]+"="));return o.join("")};for(var i=[],r=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,u=s.length;a<u;++a)i[a]=s[a],r[s.charCodeAt(a)]=a;function c(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");return-1===n&&(n=e),[n,n===e?0:4-n%4]}function l(t){return i[t>>18&63]+i[t>>12&63]+i[t>>6&63]+i[63&t]}function h(t,e,n){for(var i,r=[],o=e;o<n;o+=3)i=(t[o]<<16&16711680)+(t[o+1]<<8&65280)+(255&t[o+2]),r.push(l(i));return r.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},function(t,e){e.read=function(t,e,n,i,r){var o,s,a=8*r-i-1,u=(1<<a)-1,c=u>>1,l=-7,h=n?r-1:0,f=n?-1:1,p=t[e+h];for(h+=f,o=p&(1<<-l)-1,p>>=-l,l+=a;l>0;o=256*o+t[e+h],h+=f,l-=8);for(s=o&(1<<-l)-1,o>>=-l,l+=i;l>0;s=256*s+t[e+h],h+=f,l-=8);if(0===o)o=1-c;else{if(o===u)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,i),o-=c}return(p?-1:1)*s*Math.pow(2,o-i)},e.write=function(t,e,n,i,r,o){var s,a,u,c=8*o-r-1,l=(1<<c)-1,h=l>>1,f=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,p=i?0:o-1,d=i?1:-1,y=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=l):(s=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-s))<1&&(s--,u*=2),(e+=s+h>=1?f/u:f*Math.pow(2,1-h))*u>=2&&(s++,u/=2),s+h>=l?(a=0,s=l):s+h>=1?(a=(e*u-1)*Math.pow(2,r),s+=h):(a=e*Math.pow(2,h-1)*Math.pow(2,r),s=0));r>=8;t[n+p]=255&a,p+=d,a/=256,r-=8);for(s=s<<r|a,c+=r;c>0;t[n+p]=255&s,p+=d,s/=256,c-=8);t[n+p-d]|=128*y}},function(t,e){},function(t,e,n){"use strict";var i=n(12).Buffer,r=n(64);function o(t,e,n){t.copy(e,n)}t.exports=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.head=null,this.tail=null,this.length=0}return t.prototype.push=function(t){var e={data:t,next:null};this.length>0?this.tail.next=e:this.head=e,this.tail=e,++this.length},t.prototype.unshift=function(t){var e={data:t,next:this.head};0===this.length&&(this.tail=e),this.head=e,++this.length},t.prototype.shift=function(){if(0!==this.length){var t=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,t}},t.prototype.clear=function(){this.head=this.tail=null,this.length=0},t.prototype.join=function(t){if(0===this.length)return"";for(var e=this.head,n=""+e.data;e=e.next;)n+=t+e.data;return n},t.prototype.concat=function(t){if(0===this.length)return i.alloc(0);if(1===this.length)return this.head.data;for(var e=i.allocUnsafe(t>>>0),n=this.head,r=0;n;)o(n.data,e,r),r+=n.data.length,n=n.next;return e},t}(),r&&r.inspect&&r.inspect.custom&&(t.exports.prototype[r.inspect.custom]=function(){var t=r.inspect({length:this.length});return this.constructor.name+" "+t})},function(t,e){},function(t,e,n){(function(e){function n(t){try{if(!e.localStorage)return!1}catch(t){return!1}var n=e.localStorage[t];return null!=n&&"true"===String(n).toLowerCase()}t.exports=function(t,e){if(n("noDeprecation"))return t;var i=!1;return function(){if(!i){if(n("throwDeprecation"))throw new Error(e);n("traceDeprecation")?console.trace(e):console.warn(e),i=!0}return t.apply(this,arguments)}}}).call(this,n(2))},function(t,e,n){"use strict";t.exports=o;var i=n(42),r=n(9);function o(t){if(!(this instanceof o))return new o(t);i.call(this,t)}r.inherits=n(6),r.inherits(o,i),o.prototype._transform=function(t,e,n){n(null,t)}},function(t,e,n){t.exports=n(17)},function(t,e,n){t.exports=n(7)},function(t,e,n){t.exports=n(16).Transform},function(t,e,n){t.exports=n(16).PassThrough},function(t,e){function n(t,e){this.index=t,this.values=e}function i(t,e){this.index=t,this.howMany=e}function r(t,e,n){this.from=t,this.to=e,this.howMany=n}function o(t,e){return t===e}function s(t,e,s){s||(s=o);for(var a=t.length,u=e.length,c=[],l={},h={},f=0;f<a;f++)for(var p=t[f],d=0;d<u;d++)if(!h[d]&&s(p,e[d])){var y=f,g=d,v=0;do{l[f++]=h[d++]=!0,v++}while(f<a&&d<u&&s(t[f],e[d])&&!h[d]);c.push(new r(y,g,v)),f--;break}var b=[];for(f=0;f<a;)if(l[f])f++;else{var m=f;for(v=0;f<a&&!l[f++];)v++;b.push(new i(m,v))}var w=[];for(d=0;d<u;)if(h[d])d++;else{for(m=d,v=0;d<u&&!h[d++];)v++;var _=e.slice(m,m+v);w.push(new n(m,_))}var S,k,O=w.length,E=b.length,x=c.length,D=0;for(S=0;S<E;S++){var T=b[S];for(T.index-=D,D+=T.howMany,k=0;k<x;k++){(M=c[k]).from>=T.index&&(M.from-=T.howMany)}}for(S=O;S--;){var P=w[S];v=P.values.length;for(k=x;k--;){(M=c[k]).to>=P.index&&(M.to-=v)}}for(S=x;S-- >1;){if((M=c[S]).to!==M.from)for(k=S;k--;){var A=c[k];A.to>=M.to&&(A.to-=M.howMany),A.to>=M.from&&(A.to+=M.howMany)}}var R=[];for(S=0;S<x;S++){var M;if((M=c[S]).to!==M.from)for(R.push(M),k=S+1;k<x;k++){var j=c[k];j.from>=M.from&&(j.from-=M.howMany),j.from>=M.to&&(j.from+=M.howMany)}}return b.concat(R,w)}t.exports=s,s.InsertDiff=n,s.RemoveDiff=i,s.MoveDiff=r,n.prototype.type="insert",n.prototype.toJSON=function(){return{type:this.type,index:this.index,values:this.values}},i.prototype.type="remove",i.prototype.toJSON=function(){return{type:this.type,index:this.index,howMany:this.howMany}},r.prototype.type="move",r.prototype.toJSON=function(){return{type:this.type,from:this.from,to:this.to,howMany:this.howMany}}},function(t,e){var n=Array.prototype.slice,i="function"==typeof Object.keys?Object.keys:function(t){var e=[];for(var n in t)e.push(n);return e},r=t.exports=function(t,e){return 0===t&&0===e?function(t,e){return 1/t==1/e}(t,e):t===e||(t instanceof Date&&e instanceof Date?t.getTime()===e.getTime():a(t)?a(e):"object"!=typeof t&&"object"!=typeof e?t==e:function(t,e){if(o(t)||o(e))return!1;if(t.prototype!==e.prototype)return!1;if(s(t))return!!s(e)&&(t=n.call(t),e=n.call(e),r(t,e));try{var a,u,c=i(t),l=i(e)}catch(t){return!1}if(c.length!=l.length)return!1;for(c.sort(),l.sort(),u=c.length-1;u>=0;u--)if(c[u]!=l[u])return!1;for(u=c.length-1;u>=0;u--)if(a=c[u],!r(t[a],e[a]))return!1;return!0}(t,e))};function o(t){return null===t||void 0===t}function s(t){return"[object Arguments]"==Object.prototype.toString.call(t)}function a(t){return"number"==typeof t&&t!=t}},function(t,e,n){(function(e){var i=n(35).Duplex,r=n(34).inherits,o=n(3);function s(){this.readyState=0,this.stream=new a(this)}function a(t){i.call(this,{objectMode:!0}),this.socket=t,this.on("error",function(e){console.warn("ShareDB client message stream error",e),t.close("stopped")}),this.on("finish",function(){t.close("stopped")})}t.exports=s,s.prototype._open=function(){0===this.readyState&&(this.readyState=1,this.onopen())},s.prototype.close=function(t){3!==this.readyState&&(this.readyState=3,this.stream.push(null),this.onclose(t||"closed"))},s.prototype.send=function(t){this.stream.push(JSON.parse(t))},s.prototype.onmessage=o.doNothing,s.prototype.onclose=o.doNothing,s.prototype.onerror=o.doNothing,s.prototype.onopen=o.doNothing,r(a,i),a.prototype.isServer=!0,a.prototype._read=o.doNothing,a.prototype._write=function(t,n,i){var r=this.socket;e.nextTick(function(){1===r.readyState&&(r.onmessage({data:JSON.stringify(t)}),i())})}}).call(this,n(0))},function(t,e,n){(function(e){var i=n(15),r=n(1);function o(t){i.call(this,t),this._milestoneSnapshots={}}t.exports=o,o.prototype=Object.create(i.prototype),o.prototype.getMilestoneSnapshot=function(t,n,i,o){if(o||(o=function(){}),!t)return e.nextTick(o,new r(4001,"Missing collection"));if(!n)return e.nextTick(o,new r(4001,"Missing ID"));if(!this._isValidVersion(i))return e.nextTick(o,new r(4001,"Invalid version"));for(var s,a=this._getMilestoneSnapshotsSync(t,n),u=0;u<a.length;u++){var c=a[u];if(!(c.v<=i||null===i))break;s=c}e.nextTick(o,null,s)},o.prototype.saveMilestoneSnapshot=function(t,n,i){if(i=i||function(e){if(e)return this.emit("error",e);this.emit("save",t,n)}.bind(this),!t)return i(new r(4001,"Missing collection"));if(!n)return i(new r(4001,"Missing snapshot"));var o=this._getMilestoneSnapshotsSync(t,n.id);o.push(n),o.sort(function(t,e){return t.v-e.v}),e.nextTick(i,null)},o.prototype._getMilestoneSnapshotsSync=function(t,e){var n=this._milestoneSnapshots[t]||(this._milestoneSnapshots[t]={});return n[e]||(n[e]=[])}}).call(this,n(0))},function(t,e,n){e.Connection=n(27),e.Doc=n(28),e.Error=n(1),e.Query=n(29),e.types=n(4)}]);